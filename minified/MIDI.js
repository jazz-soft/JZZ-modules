var dom;"undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";function a(e){s++;var n=document.body,t=new Audio,o=e.split(";")[0];t.id="audio",t.setAttribute("preload","auto"),t.setAttribute("audiobuffer",!0),t.addEventListener("error",function(){n.removeChild(t),u[o]=!1,s--},!1),t.addEventListener("canplaythrough",function(){n.removeChild(t),u[o]=!0,s--},!1),t.src="data:"+e,n.appendChild(t)}var u={},s=0;e.audioDetect=function(n){if(navigator.requestMIDIAccess)if(Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))u.webmidi=!0;else for(var e=0;navigator.plugins.length>e;e++){0<=navigator.plugins[e].name.indexOf("Jazz-Plugin")&&(u.webmidi=!0)}if("undefined"==typeof Audio)return n({});u.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(u.webaudio=!0);var t=new Audio;if(void 0===t.canPlayType)return n(u);var o,r,i="probably"===(i=t.canPlayType('audio/ogg; codecs="vorbis"'))||"maybe"===i,t="probably"===(t=t.canPlayType("audio/mpeg"))||"maybe"===t;i||t?(i&&a("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),t&&a("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"),o=(new Date).getTime(),r=window.setInterval(function(){var e=(new Date).getTime();s&&!(5e3<e-o)||(window.clearInterval(r),n(u))},1)):n(u)}}(MIDI),function(r){"use strict";r.GM=function(e){function n(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()}var t,o={byName:{},byId:{},byCategory:{}};for(t in e)for(var r=e[t],i=0,a=r.length;i<a;i++){var u,s=r[i];s&&(u=parseInt(s.substr(0,s.indexOf(" ")),10),s=s.replace(u+" ",""),o.byId[--u]=o.byName[n(s)]=o.byCategory[n(t)]={id:n(s),instrument:s,number:u,category:t})}return o}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),r.getInstrument=function(e){e=r.channels[e];return e&&e.instrument},r.setInstrument=function(e,n,t){var o=r.channels[e];if(t)return setTimeout(function(){o.instrument=n},t);o.instrument=n},r.getMono=function(e){e=r.channels[e];return e&&e.mono},r.setMono=function(e,n,t){var o=r.channels[e];if(t)return setTimeout(function(){o.mono=n},t);o.mono=n},r.getOmni=function(e){e=r.channels[e];return e&&e.omni},r.setOmni=function(e,n){var t=r.channels[e];if(delay)return setTimeout(function(){t.omni=n},delay);t.omni=n},r.getSolo=function(e){e=r.channels[e];return e&&e.solo},r.setSolo=function(e,n){var t=r.channels[e];if(delay)return setTimeout(function(){t.solo=n},delay);t.solo=n},r.channels=function(){for(var e={},n=0;n<16;n++)e[n]={instrument:n,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),r.keyToNote={},r.noteToKey={},function(){for(var e=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],n=21;n<=108;n++){var t=e[n%12]+((n-12)/12>>0);r.keyToNote[t]=n,r.noteToKey[n]=t}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(d){"use strict";d.DEBUG=!0,d.USE_XHR=!0,d.soundfontUrl="./soundfont/",d.loadPlugin=function(o){"function"==typeof o&&(o={onsuccess:o}),d.soundfontUrl=o.soundfontUrl||d.soundfontUrl,d.audioDetect(function(e){var n=window.location.hash,t="";e[o.api]?t=o.api:e[n.substr(1)]?t=n.substr(1):e.webmidi?t="webmidi":window.AudioContext?t="webaudio":window.Audio&&(t="audiotag"),r[t]&&(n=o.targetFormat?o.targetFormat:e["audio/ogg"]?"ogg":"mp3",d.__api=t,d.__audioFormat=n,d.supports=e,d.loadResource(o))})},d.loadResource=function(e){var n=e.instruments||e.instrument||"acoustic_grand_piano";"object"!=typeof n&&(n=n||0===n?[n]:[]);for(var t=0;t<n.length;t++){var o=n[t];o===+o&&d.GM.byId[o]&&(n[t]=d.GM.byId[o].id)}e.format=d.__audioFormat,e.instruments=n,r[d.__api](e)};var r={webmidi:function(e){d.WebMIDI.connect(e)},audiotag:function(e){n(e,"AudioTag")},webaudio:function(e){n(e,"WebAudio")}},n=function(e,n){for(var t=e.format,o=e.instruments,r=e.onprogress,i=e.onerror,a=o.length,u=a,s=function(){--u||(r&&r("load",1),d[n].connect(e))},c=0;c<a;c++){var l=o[c];MIDI.Soundfont[l]?s():f(o[c],t,function(e,n){r&&r("load",n/a+(a-u)/a,l)},function(){s()},i)}},f=function(e,n,t,o,r){n=d.soundfontUrl+e+"-"+n+".js";d.USE_XHR?d.util.request({url:n,format:"text",onerror:r,onprogress:t,onsuccess:function(e,n){var t=document.createElement("script");t.language="javascript",t.type="text/javascript",t.text=n,document.body.appendChild(t),o()}}):dom.loadScript.add({url:n,verify:'MIDI.Soundfont["'+e+'"]',onerror:r,onsuccess:function(){o()}})};d.setDefaultPlugin=function(e){for(var n in e)d[n]=e[n]}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),void 0===MIDI.Player&&(MIDI.Player={}),function(){"use strict";var h=MIDI.Player;h.currentTime=0,h.endTime=0,h.restart=0,h.playing=!1,h.timeWarp=1,h.startDelay=0,h.BPM=120,h.start=h.resume=function(e){h.currentTime<-1&&(h.currentTime=-1),c(h.currentTime,null,e)},h.pause=function(){var e=h.restart;w(),h.restart=e},h.stop=function(){w(),h.restart=0,h.currentTime=0},h.addListener=function(e){u=e},h.removeListener=function(){u=void 0},h.clearAnimation=function(){h.animationFrameId&&cancelAnimationFrame(h.animationFrameId)},h.setAnimation=function(o){var r=0,i=0,a=0;h.clearAnimation();var u=function(){var e,n,t;h.animationFrameId=requestAnimationFrame(u),0!==h.endTime&&(h.playing?(r=a===h.currentTime?i-Date.now():0,r=0===h.currentTime?0:h.currentTime-r,a!==h.currentTime&&(i=Date.now(),a=h.currentTime)):r=h.currentTime,n=h.endTime,(t=n/1e3)-(n=60*(n=(e=r/1e3)/60)+(e-60*n))<-1||o({now:n,end:t,events:s}))};requestAnimationFrame(u)},h.loadMidiFile=function(e,n,t){try{h.replayer=new Replayer(MidiFile(h.currentData),h.timeWarp,null,h.BPM),h.data=h.replayer.getData(),h.endTime=b(),MIDI.loadPlugin({onsuccess:e,onprogress:n,onerror:t})}catch(e){t&&t(e)}},h.loadFile=function(e,a,u,s){var n;h.stop(),-1!==e.indexOf("base64,")?(n=window.atob(e.split(",")[1]),h.currentData=n,h.loadMidiFile(a,u,s)):((n=new XMLHttpRequest).open("GET",e),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var e=this.responseText||"",n=[],t=e.length,o=String.fromCharCode,r=0;r<t;r++)n[r]=o(255&e.charCodeAt(r));var i=n.join("");h.currentData=i,h.loadMidiFile(a,u,s)}else s&&s("Unable to load MIDI file")},n.send())},h.getFileInstruments=function(){for(var e={},n={},t=0;t<h.data.length;t++){var o=h.data[t][0].event;if("channel"===o.type){var r=o.channel;switch(o.subtype){case"controller":break;case"programChange":n[r]=o.programNumber;break;case"noteOn":o=n[r];e[MIDI.GM.byId[isFinite(o)?o:r].id]=!0}}}var i,a=[];for(i in e)a.push(i);return a};function q(n,t,o,e,r,i,a){return setTimeout(function(){var e={channel:n,note:t,now:o,end:h.endTime,message:r,velocity:i};128===r?delete s[t]:s[t]=e,u&&u(e),h.currentTime=o,S.shift(),(S.length<1e3||h.currentTime===y&&y<h.endTime)&&c(y,!0)},o-e)}function g(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(h.ctx={currentTime:0},h.ctx)}var y,v,S=[],I=0,s={},u=void 0,b=function(){for(var e=h.data,n=e.length,t=.5,o=0;o<n;o++)t+=e[o][1];return t},c=function(e,n,t){if(h.replayer){var o;n||(void 0===e&&(e=h.restart),h.playing&&w(),h.playing=!0,h.data=h.replayer.getData(),h.endTime=b());var r=0,i=0,a=h.data,u=g(),s=a.length;y=.5;S[0]&&S[0].interval;var c=e-h.currentTime;"webaudio"!==MIDI.api&&(n=(window.performance&&window.performance.now?window.performance:Date).now(),v=v||n,u.currentTime=(n-v)/1e3),I=u.currentTime;for(var l=0;l<s&&i<100;l++){var d=a[l];if((y+=d[1])<=e)r=y;else{e=y-r;var f=d[0].event;if("channel"===f.type){var A=f.channel,p=MIDI.channels[A],m=u.currentTime+(e+c+h.startDelay)/1e3,d=y-r+h.startDelay;switch(f.subtype){case"controller":MIDI.setController(A,f.controllerType,f.value,m);break;case"programChange":MIDI.programChange(A,f.programNumber,m);break;case"pitchBend":MIDI.pitchBend(A,f.value,m);break;case"noteOn":if(p.mute)break;o=f.noteNumber-(h.MIDIOffset||0),S.push({event:f,time:d,source:MIDI.noteOn(A,f.noteNumber,f.velocity,m),interval:q(A,o,y+h.startDelay,r-c,144,f.velocity)}),i++;break;case"noteOff":if(p.mute)break;o=f.noteNumber-(h.MIDIOffset||0),S.push({event:f,time:d,source:MIDI.noteOff(A,f.noteNumber,m),interval:q(A,o,y,r-c,128,0)})}}}}t&&t(S)}},w=function(){var e,n=g();for(h.playing=!1,h.restart+=1e3*(n.currentTime-I);S.length;){var t=S.pop();window.clearInterval(t.interval),t.source&&("number"==typeof t.source?window.clearTimeout(t.source):t.source.disconnect(0))}for(e in s){t=s[e];144===s[e].message&&u&&u({channel:t.channel,note:t.note,now:t.now,end:t.end,message:128,velocity:t.velocity})}s={}}}(),function(A){"use strict";window.Audio&&function(){for(var t=A.AudioTag={api:"audiotag"},u={},i=127,s=-1,c=[],l=[],d={},e=0;e<12;e++)c[e]=new Audio;function f(e,n){if(A.channels[e]){var t=A.channels[e].instrument,o=A.GM.byId[t].id;if(n=d[n]){var r=o+""+n.id,e=(s+1)%c.length,t=c[e];if(l[e]=r,!A.Soundfont[o])return A.DEBUG&&console.log("404",o),0;t.src=A.Soundfont[o][n.id],t.volume=i/127,t.play(),s=e}}}function a(e,n){if(A.channels[e]){e=A.channels[e].instrument,e=A.GM.byId[e].id;if(n=d[n])for(var t=e+""+n.id,o=0,r=c.length;o<r;o++){var i=(o+s+1)%r,a=l[i];if(a&&a==t)return c[i].pause(),l[i]=null,0}}}t.audioBuffers=c,t.send=function(e,n){},t.setController=function(e,n,t,o){},t.setVolume=function(e,n){i=n},t.programChange=function(e,n){A.channels[e].instrument=n},t.pitchBend=function(e,n,t){},t.noteOn=function(e,n,t,o){var r=u[n];if(d[r])return o?setTimeout(function(){f(e,r)},1e3*o):void f(e,r)},t.noteOff=function(e,n,t){},t.chordOn=function(e,n,t,o){for(var r=0;r<n.length;r++){var i=n[r],a=u[i];if(d[a]){if(o)return setTimeout(function(){f(e,a)},1e3*o);f(e,a)}}},t.chordOff=function(e,n,t){for(var o=0;o<n.length;o++){var r=n[o],i=u[r];if(d[i]){if(t)return setTimeout(function(){a(e,i)},1e3*t);a(e,i)}}},t.stopAllNotes=function(){for(var e=0,n=c.length;e<n;e++)c[e].pause()},t.connect=function(e){for(var n in A.setDefaultPlugin(t),A.keyToNote)u[A.keyToNote[n]]=n,d[n]={id:n};e.onsuccess&&e.onsuccess()}}()}(MIDI),function(A){"use strict";var p,s,c,l,d,m;window.AudioContext&&(s=A.WebAudio={api:"webaudio"},c={},l={},d=127,m={},s.audioBuffers=m,s.send=function(e,n){},s.setController=function(e,n,t,o){},s.setVolume=function(e,n,t){t?setTimeout(function(){d=n},1e3*t):d=n},s.programChange=function(e,n,t){A.channels[e].instrument=n},s.pitchBend=function(e,n,t){A.channels[e].pitchBend=n},s.noteOn=function(e,n,t,o){o=o||0;var r=A.channels[e].instrument,i=m[r+""+n];if(i){if(o<p.currentTime&&(o+=p.currentTime),(r=p.createBufferSource()).buffer=i,l){var a,u=r;for(a in l)u.connect(l[a].input),u=l[a]}t=t/127*(d/127)*2-1;return r.connect(p.destination),r.playbackRate.value=1,r.gainNode=p.createGain(),r.gainNode.connect(p.destination),r.gainNode.gain.value=Math.min(1,Math.max(-1,t)),r.connect(r.gainNode),r.start(o||0),c[e+""+n]=r}},s.noteOff=function(e,n,t){t=t||0;var o=A.channels[e].instrument,r=m[o+""+n];if(r){t<p.currentTime&&(t+=p.currentTime);o=c[e+""+n];if(o)return o.gainNode&&((r=o.gainNode.gain).linearRampToValueAtTime(r.value,t),r.linearRampToValueAtTime(-1,t+.3)),o.noteOff?o.noteOff(t+.5):o.stop(t+.5),delete c[e+""+n],o}},s.chordOn=function(e,n,t,o){for(var r,i={},a=0,u=n.length;a<u;a++)i[r=n[a]]=s.noteOn(e,r,t,o);return i},s.chordOff=function(e,n,t){for(var o,r={},i=0,a=n.length;i<a;i++)r[o=n[i]]=s.noteOff(e,o,t);return r},s.stopAllNotes=function(){for(var e in c){var n=0;n<p.currentTime&&(n+=p.currentTime);var t=c[e];t.gain.linearRampToValueAtTime(1,n),t.gain.linearRampToValueAtTime(0,n+.3),t.noteOff?t.noteOff(n+.3):t.stop(n+.3),delete c[e]}},s.setEffects=function(e){if(!p.tunajs)return console.log("Effects module not installed.");for(var n=0;n<e.length;n++){var t=e[n],o=new p.tunajs[t.type](t);o.connect(p.destination),l[t.type]=o}},s.connect=function(e){A.setDefaultPlugin(s),s.setContext(p||new(window.AudioContext||window.webkitAudioContext),e.onsuccess)},s.getContext=function(){return p},s.setContext=function(e,t,n,o){p=e,"undefined"==typeof Tuna||p.tunajs||(p.tunajs=new Tuna(p));var r=[];for(l in A.keyToNote)r.push(l);function i(e){for(var n in s)if(s[n])return;t&&(t(),t=null)}function a(t,o,e,r){var n=t[r];n&&(s[o]++,function(e,n,t){{var o,r;0===e.indexOf("data:audio")?(o=e.split(",")[1],o=Base64Binary.decodeArrayBuffer(o),p.decodeAudioData(o,n,t)):((r=new XMLHttpRequest).open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){p.decodeAudioData(r.response,n,t)},r.send())}}(n,function(e){e.id=r;var n=A.keyToNote[r];m[o+""+n]=e,0==--s[o]&&(t.isLoaded=!0,i())},function(e){}))}var u,s={};for(u in A.Soundfont){var c=A.Soundfont[u];if(!c.isLoaded)for(var l,d=A.GM.byName[u].number,f=s[d]=0;f<r.length;f++){a(c,d,0,l=r[f])}}setTimeout(i,1)})}(MIDI),function(o){"use strict";var a=null,e=o.WebMIDI={api:"webmidi"};e.send=function(e,n){a.send(e,1e3*n)},e.setController=function(e,n,t,o){a.send([e,n,t],1e3*o)},e.setVolume=function(e,n,t){a.send([176+e,7,n],1e3*t)},e.programChange=function(e,n,t){a.send([192+e,n],1e3*t)},e.pitchBend=function(e,n,t){a.send([224+e,n],1e3*t)},e.noteOn=function(e,n,t,o){a.send([144+e,n,t],1e3*o)},e.noteOff=function(e,n,t){a.send([128+e,n,0],1e3*t)},e.chordOn=function(e,n,t,o){for(var r=0;r<n.length;r++){var i=n[r];a.send([144+e,i,t],1e3*o)}},e.chordOff=function(e,n,t){for(var o=0;o<n.length;o++){var r=n[o];a.send([128+e,r,0],1e3*t)}},e.stopAllNotes=function(){a.cancel();for(var e=0;e<16;e++)a.send([176+e,123,0])},e.connect=function(n){o.setDefaultPlugin(e);function t(e){if(window.AudioContext)n.api="webaudio";else{if(!window.Audio)return;n.api="audiotag"}o.loadPlugin(n)}navigator.requestMIDIAccess().then(function(e){e=e.outputs;void 0===(a=("function"==typeof e?e():e)[0])?t():n.onsuccess&&n.onsuccess()},t)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),function(A){var p;(A.util||(A.util={})).request=function(e,t,o,r){"use strict";"string"==typeof e&&(e={url:e});var n=e.data,i=e.url,a=e.method||(e.data?"POST":"GET"),u=e.format,s=e.headers,c=e.responseType,l=e.withCredentials||!1,t=t||e.onsuccess,o=o||e.onerror,r=r||e.onprogress;if(void 0===p||!A.loc.isLocalUrl(i)){var d=new XMLHttpRequest;if(d.open(a,i,!0),s)for(var f in s)d.setRequestHeader(f,s[f]);else n&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded");"binary"===u&&d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),c&&(d.responseType=c),l&&(d.withCredentials="true"),o&&"onerror"in d&&(d.onerror=o),r&&d.upload&&"onprogress"in d.upload&&(n?d.upload.onprogress=function(e){r.call(d,e,event.loaded/event.total)}:d.addEventListener("progress",function(e){var n=0;if(e.lengthComputable)n=e.total;else if(d.totalBytes)n=d.totalBytes;else{var t=parseInt(d.getResponseHeader("Content-Length-Raw"));if(!isFinite(t))return;d.totalBytes=n=t}r.call(d,e,e.loaded/n)})),d.onreadystatechange=function(n){if(4===d.readyState)if(200===d.status||304===d.status||308===d.status||0===d.status&&A.client.cordova){if(t){var e;if("xml"===u)e=n.target.responseXML;else if("text"===u)e=n.target.responseText;else if("json"===u)try{e=JSON.parse(n.target.response)}catch(e){o&&o.call(d,n)}t.call(d,n,e)}}else o&&o.call(d,n)};try{d.send(n)}catch(e){o&&o.call(d)}return d}p.readFile(i,"utf8",function(e,n){e?o&&o(e):t&&t({responseText:n})})},"undefined"!=typeof module&&module.exports&&(p=require("fs"),XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=A.util.request)}(MIDI),void 0===dom&&(dom={}),function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(r){var i=this;"string"==typeof r&&(r={url:r});var o=r.urls;void 0===o&&(o=[{url:r.url,verify:r.verify}]);function a(e,n){i.loaded[e.url]||n&&!1===p(n)||(i.loaded[e.url]=!0,i.loading[e.url]&&i.loading[e.url](),delete i.loading[e.url],e.onsuccess&&e.onsuccess(),void 0!==A&&A())}function t(n){if("string"==typeof n&&(n={url:n,verify:r.verify}),/([\w\d.\[\]\'\"])$/.test(n.verify)){var e=n.test=n.verify;if("object"==typeof e)for(var t=0;t<e.length;t++)c.push(e[t]);else c.push(e)}var o;i.loaded[n.url]||((o=document.createElement("script")).onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||a(n)},o.onload=function(){a(n)},o.onerror=function(){if(s=!0,delete i.loading[n.url],"object"==typeof n.test)for(var e in n.test)l(n.test[e]);else l(n.test)},o.setAttribute("type","text/javascript"),o.setAttribute("src",n.url),u.appendChild(o),i.loading[n.url]=function(){})}var u=document.getElementsByTagName("head")[0],s=!1,c=[],l=function(e){for(var n=[],t=0;t<c.length;t++)c[t]!==e&&n.push(c[t]);c=n},d=function(e){if(e)a(e,e.test);else for(var n=0;n<o.length;n++)a(o[n],o[n].test);for(var t=!0,n=0;n<c.length;n++)!1===p(c[n])&&(t=!1);!r.strictOrder&&t?s?r.error&&r.error():r.onsuccess&&r.onsuccess():setTimeout(function(){d(e)},10)};if(r.strictOrder){var f=-1,A=function(){var e,n;o[++f]?(n=(e=o[f]).url,i.loading[n]?i.loading[n]=function(){e.onsuccess&&e.onsuccess(),A()}:i.loaded[n]?A():(t(e),d(e))):s?r.error&&r.error():r.onsuccess&&r.onsuccess()};A()}else for(f=0;f<o.length;f++)t(o[f]),d(o[f])},dom.loadScript=new dom.loadScript;var p=function(e,n){try{for(var t=(e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".")).split("."),o=t.length,r=n||window,i=0;i<o;i++){var a=t[i];if(null==r[a])return!1;r=r[a]}return!0}catch(e){return!1}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript),function(){var e="undefined"!=typeof exports?exports:this,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function u(e){this.message=e}(u.prototype=new Error).name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var n,t,o=0,r=a,i="";e.charAt(0|o)||(r="=",o%1);i+=r.charAt(63&n>>8-o%1*8)){if(255<(t=e.charCodeAt(o+=.75)))throw new u("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|t}return i}),e.atob||(e.atob=function(e){if((e=e.replace(/=+$/,"")).length%4==1)throw new u("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,t,o=0,r=0,i="";t=e.charAt(r++);~t&&(n=o%4?64*n+t:t,o++%4)&&(i+=String.fromCharCode(255&n>>(-2*o&6))))t=a.indexOf(t);return i})}();var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var n=Math.ceil(3*e.length/4),n=new ArrayBuffer(n);return this.decode(e,n),n},decode:function(e,n){var t,o,r,i,a,u=this._keyStr.indexOf(e.charAt(e.length-1)),s=this._keyStr.indexOf(e.charAt(e.length-1)),c=Math.ceil(3*e.length/4);64==u&&c--,64==s&&c--;var l=0,d=0,f=n?new Uint8Array(n):new Uint8Array(c);for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),l=0;l<c;l+=3)t=this._keyStr.indexOf(e.charAt(d++))<<2|(r=this._keyStr.indexOf(e.charAt(d++)))>>4,o=(15&r)<<4|(i=this._keyStr.indexOf(e.charAt(d++)))>>2,r=(3&i)<<6|(a=this._keyStr.indexOf(e.charAt(d++))),f[l]=t,64!=i&&(f[l+1]=o),64!=a&&(f[l+2]=r);return f}};