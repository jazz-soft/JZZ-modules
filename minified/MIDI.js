if("undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var u={},s=0,c=function(e){s++;var n=document.body,t=new Audio,r=e.split(";")[0];t.id="audio",t.setAttribute("preload","auto"),t.setAttribute("audiobuffer",!0),t.addEventListener("error",function(){n.removeChild(t),u[r]=!1,s--},!1),t.addEventListener("canplaythrough",function(){n.removeChild(t),u[r]=!0,s--},!1),t.src="data:"+e,n.appendChild(t)};e.audioDetect=function(n){if(navigator.requestMIDIAccess)if(Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))u.webmidi=!0;else for(var e=0;navigator.plugins.length>e;e++){0<=navigator.plugins[e].name.indexOf("Jazz-Plugin")&&(u.webmidi=!0)}if("undefined"==typeof Audio)return n({});u.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(u.webaudio=!0);var t=new Audio;if(void 0===t.canPlayType)return n(u);var r=t.canPlayType('audio/ogg; codecs="vorbis"');r="probably"===r||"maybe"===r;var o=t.canPlayType("audio/mpeg");if(o="probably"===o||"maybe"===o,r||o){r&&c("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),o&&c("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var i=(new Date).getTime(),a=window.setInterval(function(){var e=(new Date).getTime();s&&!(5e3<e-i)||(window.clearInterval(a),n(u))},1)}else n(u)}}(MIDI),function(o){"use strict";o.GM=function(e){var n=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},t={byName:{},byId:{},byCategory:{}};for(var r in e)for(var o=e[r],i=0,a=o.length;i<a;i++){var u=o[i];if(u){var s=parseInt(u.substr(0,u.indexOf(" ")),10);u=u.replace(s+" ",""),t.byId[--s]=t.byName[n(u)]=t.byCategory[n(r)]={id:n(u),instrument:u,number:s,category:r}}}return t}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),o.getInstrument=function(e){var n=o.channels[e];return n&&n.instrument},o.setInstrument=function(e,n,t){var r=o.channels[e];if(t)return setTimeout(function(){r.instrument=n},t);r.instrument=n},o.getMono=function(e){var n=o.channels[e];return n&&n.mono},o.setMono=function(e,n,t){var r=o.channels[e];if(t)return setTimeout(function(){r.mono=n},t);r.mono=n},o.getOmni=function(e){var n=o.channels[e];return n&&n.omni},o.setOmni=function(e,n){var t=o.channels[e];if(delay)return setTimeout(function(){t.omni=n},delay);t.omni=n},o.getSolo=function(e){var n=o.channels[e];return n&&n.solo},o.setSolo=function(e,n){var t=o.channels[e];if(delay)return setTimeout(function(){t.solo=n},delay);t.solo=n},o.channels=function(){for(var e={},n=0;n<16;n++)e[n]={instrument:n,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),o.keyToNote={},o.noteToKey={},function(){for(var e=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],n=21;n<=108;n++){var t=e[n%12]+((n-12)/12>>0);o.keyToNote[t]=n,o.noteToKey[n]=t}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(d){"use strict";d.DEBUG=!0,d.USE_XHR=!0,d.soundfontUrl="./soundfont/",d.loadPlugin=function(o){"function"==typeof o&&(o={onsuccess:o}),d.soundfontUrl=o.soundfontUrl||d.soundfontUrl,d.audioDetect(function(e){var n=window.location.hash,t="";if(e[o.api]?t=o.api:e[n.substr(1)]?t=n.substr(1):e.webmidi?t="webmidi":window.AudioContext?t="webaudio":window.Audio&&(t="audiotag"),i[t]){if(o.targetFormat)var r=o.targetFormat;else r=e["audio/ogg"]?"ogg":"mp3";d.__api=t,d.__audioFormat=r,d.supports=e,d.loadResource(o)}})},d.loadResource=function(e){var n=e.instruments||e.instrument||"acoustic_grand_piano";"object"!=typeof n&&(n=n||0===n?[n]:[]);for(var t=0;t<n.length;t++){var r=n[t];r===+r&&d.GM.byId[r]&&(n[t]=d.GM.byId[r].id)}e.format=d.__audioFormat,e.instruments=n,i[d.__api](e)};var i={webmidi:function(e){d.WebMIDI.connect(e)},audiotag:function(e){n(e,"AudioTag")},webaudio:function(e){n(e,"WebAudio")}},n=function(e,n){for(var t=e.format,r=e.instruments,o=e.onprogress,i=e.onerror,a=r.length,u=a,s=function(){--u||(o&&o("load",1),d[n].connect(e))},c=0;c<a;c++){var l=r[c];MIDI.Soundfont[l]?s():f(r[c],t,function(e,n){o&&o("load",n/a+(a-u)/a,l)},function(){s()},i)}},f=function(e,n,t,r,o){var i=d.soundfontUrl+e+"-"+n+".js";d.USE_XHR?d.util.request({url:i,format:"text",onerror:o,onprogress:t,onsuccess:function(e,n){var t=document.createElement("script");t.language="javascript",t.type="text/javascript",t.text=n,document.body.appendChild(t),r()}}):dom.loadScript.add({url:i,verify:'MIDI.Soundfont["'+e+'"]',onerror:o,onsuccess:function(){r()}})};d.setDefaultPlugin=function(e){for(var n in e)d[n]=e[n]}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),void 0===MIDI.Player&&(MIDI.Player={}),function(){"use strict";var q=MIDI.Player;q.currentTime=0,q.endTime=0,q.restart=0,q.playing=!1,q.timeWarp=1,q.startDelay=0,q.BPM=120,q.start=q.resume=function(e){q.currentTime<-1&&(q.currentTime=-1),s(q.currentTime,null,e)},q.pause=function(){var e=q.restart;M(),q.restart=e},q.stop=function(){M(),q.restart=0,q.currentTime=0},q.addListener=function(e){u=e},q.removeListener=function(){u=void 0},q.clearAnimation=function(){q.animationFrameId&&cancelAnimationFrame(q.animationFrameId)},q.setAnimation=function(i){var a=0,u=0,s=0;q.clearAnimation();var c=function(){if(q.animationFrameId=requestAnimationFrame(c),0!==q.endTime){q.playing?(a=s===q.currentTime?u-Date.now():0,a=0===q.currentTime?0:q.currentTime-a,s!==q.currentTime&&(u=Date.now(),s=q.currentTime)):a=q.currentTime;var e=q.endTime,n=a/1e3,t=n/60,r=60*t+(n-60*t),o=e/1e3;o-r<-1||i({now:r,end:o,events:l})}};requestAnimationFrame(c)},q.loadMidiFile=function(e,n,t){try{q.replayer=new Replayer(MidiFile(q.currentData),q.timeWarp,null,q.BPM),q.data=q.replayer.getData(),q.endTime=T(),MIDI.loadPlugin({onsuccess:e,onprogress:n,onerror:t})}catch(e){t&&t(e)}},q.loadFile=function(e,a,u,s){if(q.stop(),-1!==e.indexOf("base64,")){var n=window.atob(e.split(",")[1]);q.currentData=n,q.loadMidiFile(a,u,s)}else{var t=new XMLHttpRequest;t.open("GET",e),t.overrideMimeType("text/plain; charset=x-user-defined"),t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var e=this.responseText||"",n=[],t=e.length,r=String.fromCharCode,o=0;o<t;o++)n[o]=r(255&e.charCodeAt(o));var i=n.join("");q.currentData=i,q.loadMidiFile(a,u,s)}else s&&s("Unable to load MIDI file")},t.send()}},q.getFileInstruments=function(){for(var e={},n={},t=0;t<q.data.length;t++){var r=q.data[t][0].event;if("channel"===r.type){var o=r.channel;switch(r.subtype){case"controller":break;case"programChange":n[o]=r.programNumber;break;case"noteOn":var i=n[o];e[MIDI.GM.byId[isFinite(i)?i:o].id]=!0}}}var a=[];for(var u in e)a.push(u);return a};var g,y,S=[],I=0,l={},u=void 0,b=function(n,t,r,e,o,i,a){return setTimeout(function(){var e={channel:n,note:t,now:r,end:q.endTime,message:o,velocity:i};128===o?delete l[t]:l[t]=e,u&&u(e),q.currentTime=r,S.shift(),S.length<1e3?s(g,!0):q.currentTime===g&&g<q.endTime&&s(g,!0)},r-e)},w=function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(q.ctx={currentTime:0},q.ctx)},T=function(){for(var e=q.data,n=e.length,t=.5,r=0;r<n;r++)t+=e[r][1];return t},s=function(e,n,t){if(q.replayer){var r;n||(void 0===e&&(e=q.restart),q.playing&&M(),q.playing=!0,q.data=q.replayer.getData(),q.endTime=T());var o=0,i=0,a=q.data,u=w(),s=a.length;g=.5;S[0]&&S[0].interval;var c=e-q.currentTime;if("webaudio"!==MIDI.api){var l=window.performance&&window.performance.now?window.performance.now():Date.now();y=y||l,u.currentTime=(l-y)/1e3}I=u.currentTime;for(var d=0;d<s&&i<100;d++){var f=a[d];if((g+=f[1])<=e)o=g;else{e=g-o;var A=f[0].event;if("channel"===A.type){var p=A.channel,m=MIDI.channels[p],h=u.currentTime+(e+c+q.startDelay)/1e3,v=g-o+q.startDelay;switch(A.subtype){case"controller":MIDI.setController(p,A.controllerType,A.value,h);break;case"programChange":MIDI.programChange(p,A.programNumber,h);break;case"pitchBend":MIDI.pitchBend(p,A.value,h);break;case"noteOn":if(m.mute)break;r=A.noteNumber-(q.MIDIOffset||0),S.push({event:A,time:v,source:MIDI.noteOn(p,A.noteNumber,A.velocity,h),interval:b(p,r,g+q.startDelay,o-c,144,A.velocity)}),i++;break;case"noteOff":if(m.mute)break;r=A.noteNumber-(q.MIDIOffset||0),S.push({event:A,time:v,source:MIDI.noteOff(p,A.noteNumber,h),interval:b(p,r,g,o-c,128,0)})}}}}t&&t(S)}},M=function(){var e=w();for(q.playing=!1,q.restart+=1e3*(e.currentTime-I);S.length;){var n=S.pop();window.clearInterval(n.interval),n.source&&("number"==typeof n.source?window.clearTimeout(n.source):n.source.disconnect(0))}for(var t in l){n=l[t];144===l[t].message&&u&&u({channel:n.channel,note:n.note,now:n.now,end:n.end,message:128,velocity:n.velocity})}l={}}}(),function(p){"use strict";window.Audio&&function(){for(var t=p.AudioTag={api:"audiotag"},u={},s=127,c=-1,l=[],d=[],f={},e=0;e<12;e++)l[e]=new Audio;var A=function(e,n){if(p.channels[e]){var t=p.channels[e].instrument,r=p.GM.byId[t].id;if(n=f[n]){var o=r+""+n.id,i=(c+1)%l.length,a=l[i];if(d[i]=o,!p.Soundfont[r])return void(p.DEBUG&&console.log("404",r));a.src=p.Soundfont[r][n.id],a.volume=s/127,a.play(),c=i}}},a=function(e,n){if(p.channels[e]){var t=p.channels[e].instrument,r=p.GM.byId[t].id;if(n=f[n])for(var o=r+""+n.id,i=0,a=l.length;i<a;i++){var u=(i+c+1)%a,s=d[u];if(s&&s==o)return l[u].pause(),void(d[u]=null)}}};t.audioBuffers=l,t.send=function(e,n){},t.setController=function(e,n,t,r){},t.setVolume=function(e,n){s=n},t.programChange=function(e,n){p.channels[e].instrument=n},t.pitchBend=function(e,n,t){},t.noteOn=function(e,n,t,r){var o=u[n];if(f[o])return r?setTimeout(function(){A(e,o)},1e3*r):void A(e,o)},t.noteOff=function(e,n,t){},t.chordOn=function(e,n,t,r){for(var o=0;o<n.length;o++){var i=n[o],a=u[i];if(f[a]){if(r)return setTimeout(function(){A(e,a)},1e3*r);A(e,a)}}},t.chordOff=function(e,n,t){for(var r=0;r<n.length;r++){var o=n[r],i=u[o];if(f[i]){if(t)return setTimeout(function(){a(e,i)},1e3*t);a(e,i)}}},t.stopAllNotes=function(){for(var e=0,n=l.length;e<n;e++)l[e].pause()},t.connect=function(e){for(var n in p.setDefaultPlugin(t),p.keyToNote)u[p.keyToNote[n]]=n,f[n]={id:n};e.onsuccess&&e.onsuccess()}}()}(MIDI),function(p){"use strict";var m,s,l,d,f,h;window.AudioContext&&(s=p.WebAudio={api:"webaudio"},l={},d={},f=127,h={},s.audioBuffers=h,s.send=function(e,n){},s.setController=function(e,n,t,r){},s.setVolume=function(e,n,t){t?setTimeout(function(){f=n},1e3*t):f=n},s.programChange=function(e,n,t){p.channels[e].instrument=n},s.pitchBend=function(e,n,t){p.channels[e].pitchBend=n},s.noteOn=function(e,n,t,r){r=r||0;var o=p.channels[e].instrument,i=h[o+""+n];if(i){var a;if(r<m.currentTime&&(r+=m.currentTime),(a=m.createBufferSource()).buffer=i,d){var u=a;for(var s in d)u.connect(d[s].input),u=d[s]}var c=t/127*(f/127)*2-1;return a.connect(m.destination),a.playbackRate.value=1,a.gainNode=m.createGain(),a.gainNode.connect(m.destination),a.gainNode.gain.value=Math.min(1,Math.max(-1,c)),a.connect(a.gainNode),a.start(r||0),l[e+""+n]=a}},s.noteOff=function(e,n,t){t=t||0;var r=p.channels[e].instrument,o=h[r+""+n];if(o){t<m.currentTime&&(t+=m.currentTime);var i=l[e+""+n];if(i){if(i.gainNode){var a=i.gainNode.gain;a.linearRampToValueAtTime(a.value,t),a.linearRampToValueAtTime(-1,t+.3)}return i.noteOff?i.noteOff(t+.5):i.stop(t+.5),delete l[e+""+n],i}}},s.chordOn=function(e,n,t,r){for(var o,i={},a=0,u=n.length;a<u;a++)i[o=n[a]]=s.noteOn(e,o,t,r);return i},s.chordOff=function(e,n,t){for(var r,o={},i=0,a=n.length;i<a;i++)o[r=n[i]]=s.noteOff(e,r,t);return o},s.stopAllNotes=function(){for(var e in l){var n=0;n<m.currentTime&&(n+=m.currentTime);var t=l[e];t.gain.linearRampToValueAtTime(1,n),t.gain.linearRampToValueAtTime(0,n+.3),t.noteOff?t.noteOff(n+.3):t.stop(n+.3),delete l[e]}},s.setEffects=function(e){if(!m.tunajs)return console.log("Effects module not installed.");for(var n=0;n<e.length;n++){var t=e[n],r=new m.tunajs[t.type](t);r.connect(m.destination),d[t.type]=r}},s.connect=function(e){p.setDefaultPlugin(s),s.setContext(m||new(window.AudioContext||window.webkitAudioContext),e.onsuccess)},s.getContext=function(){return m},s.setContext=function(e,t,n,r){m=e,"undefined"==typeof Tuna||m.tunajs||(m.tunajs=new Tuna(m));var o=[],i=p.keyToNote;for(var a in i)o.push(a);var u=function(e){for(var n in c)if(c[n])return;t&&(t(),t=null)},s=function(t,r,e,o){var n=t[o];n&&(c[r]++,function(e,n,t){if(0===e.indexOf("data:audio")){var r=e.split(",")[1],o=Base64Binary.decodeArrayBuffer(r);m.decodeAudioData(o,n,t)}else{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){m.decodeAudioData(i.response,n,t)},i.send()}}(n,function(e){e.id=o;var n=p.keyToNote[o];h[r+""+n]=e,0==--c[r]&&(t.isLoaded=!0,u())},function(e){}))},c={};for(var l in p.Soundfont){var d=p.Soundfont[l];if(!d.isLoaded)for(var f=p.GM.byName[l].number,A=c[f]=0;A<o.length;A++)s(d,f,0,a=o[A])}setTimeout(u,1)})}(MIDI),function(n){"use strict";var a=null,e=n.WebMIDI={api:"webmidi"};e.send=function(e,n){a.send(e,1e3*n)},e.setController=function(e,n,t,r){a.send([e,n,t],1e3*r)},e.setVolume=function(e,n,t){a.send([176+e,7,n],1e3*t)},e.programChange=function(e,n,t){a.send([192+e,n],1e3*t)},e.pitchBend=function(e,n,t){a.send([224+e,n],1e3*t)},e.noteOn=function(e,n,t,r){a.send([144+e,n,t],1e3*r)},e.noteOff=function(e,n,t){a.send([128+e,n,0],1e3*t)},e.chordOn=function(e,n,t,r){for(var o=0;o<n.length;o++){var i=n[o];a.send([144+e,i,t],1e3*r)}},e.chordOff=function(e,n,t){for(var r=0;r<n.length;r++){var o=n[r];a.send([128+e,o,0],1e3*t)}},e.stopAllNotes=function(){a.cancel();for(var e=0;e<16;e++)a.send([176+e,123,0])},e.connect=function(t){n.setDefaultPlugin(e);var r=function(e){if(window.AudioContext)t.api="webaudio";else{if(!window.Audio)return;t.api="audiotag"}n.loadPlugin(t)};navigator.requestMIDIAccess().then(function(e){var n=e.outputs;void 0===(a="function"==typeof n?n()[0]:n[0])?r():t.onsuccess&&t.onsuccess()},r)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),function(A){if((A.util||(A.util={})).request=function(e,t,r,o){"use strict";"string"==typeof e&&(e={url:e});var n=e.data,i=e.url,a=e.method||(e.data?"POST":"GET"),u=e.format,s=e.headers,c=e.responseType,l=e.withCredentials||!1;t=t||e.onsuccess,r=r||e.onerror,o=o||e.onprogress;if(void 0===p||!A.loc.isLocalUrl(i)){var d=new XMLHttpRequest;if(d.open(a,i,!0),s)for(var f in s)d.setRequestHeader(f,s[f]);else n&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded");"binary"===u&&d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),c&&(d.responseType=c),l&&(d.withCredentials="true"),r&&"onerror"in d&&(d.onerror=r),o&&d.upload&&"onprogress"in d.upload&&(n?d.upload.onprogress=function(e){o.call(d,e,event.loaded/event.total)}:d.addEventListener("progress",function(e){var n=0;if(e.lengthComputable)n=e.total;else if(d.totalBytes)n=d.totalBytes;else{var t=parseInt(d.getResponseHeader("Content-Length-Raw"));if(!isFinite(t))return;d.totalBytes=n=t}o.call(d,e,e.loaded/n)})),d.onreadystatechange=function(n){if(4===d.readyState)if(200===d.status||304===d.status||308===d.status||0===d.status&&A.client.cordova){if(t){var e;if("xml"===u)e=n.target.responseXML;else if("text"===u)e=n.target.responseText;else if("json"===u)try{e=JSON.parse(n.target.response)}catch(e){r&&r.call(d,n)}t.call(d,n,e)}}else r&&r.call(d,n)};try{d.send(n)}catch(e){r&&r.call(d)}return d}p.readFile(i,"utf8",function(e,n){e?r&&r(e):t&&t({responseText:n})})},"undefined"!=typeof module&&module.exports){var p=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=A.util.request}}(MIDI),void 0===dom)var dom={};!function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(o){var i=this;"string"==typeof o&&(o={url:o});var r=o.urls;void 0===r&&(r=[{url:o.url,verify:o.verify}]);var a=document.getElementsByTagName("head")[0],u=function(e,n){i.loaded[e.url]||n&&!1===p(n)||(i.loaded[e.url]=!0,i.loading[e.url]&&i.loading[e.url](),delete i.loading[e.url],e.onsuccess&&e.onsuccess(),void 0!==A&&A())},s=!1,c=[],t=function(n){if("string"==typeof n&&(n={url:n,verify:o.verify}),/([\w\d.\[\]\'\"])$/.test(n.verify)){var e=n.test=n.verify;if("object"==typeof e)for(var t=0;t<e.length;t++)c.push(e[t]);else c.push(e)}if(!i.loaded[n.url]){var r=document.createElement("script");r.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||u(n)},r.onload=function(){u(n)},r.onerror=function(){if(s=!0,delete i.loading[n.url],"object"==typeof n.test)for(var e in n.test)l(n.test[e]);else l(n.test)},r.setAttribute("type","text/javascript"),r.setAttribute("src",n.url),a.appendChild(r),i.loading[n.url]=function(){}}},l=function(e){for(var n=[],t=0;t<c.length;t++)c[t]!==e&&n.push(c[t]);c=n},d=function(e){if(e)u(e,e.test);else for(var n=0;n<r.length;n++)u(r[n],r[n].test);var t=!0;for(n=0;n<c.length;n++)!1===p(c[n])&&(t=!1);!o.strictOrder&&t?s?o.error&&o.error():o.onsuccess&&o.onsuccess():setTimeout(function(){d(e)},10)};if(o.strictOrder){var f=-1,A=function(){if(r[++f]){var e=r[f],n=e.url;i.loading[n]?i.loading[n]=function(){e.onsuccess&&e.onsuccess(),A()}:i.loaded[n]?A():(t(e),d(e))}else s?o.error&&o.error():o.onsuccess&&o.onsuccess()};A()}else for(f=0;f<r.length;f++)t(r[f]),d(r[f])},dom.loadScript=new dom.loadScript;var p=function(e,n){try{for(var t=(e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".")).split("."),r=t.length,o=n||window,i=0;i<r;i++){var a=t[i];if(null==o[a])return!1;o=o[a]}return!0}catch(e){return!1}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript),function(){var e="undefined"!=typeof exports?exports:this,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function u(e){this.message=e}(u.prototype=new Error).name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var n,t,r=0,o=a,i="";e.charAt(0|r)||(o="=",r%1);i+=o.charAt(63&n>>8-r%1*8)){if(255<(t=e.charCodeAt(r+=.75)))throw new u("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|t}return i}),e.atob||(e.atob=function(e){if((e=e.replace(/=+$/,"")).length%4==1)throw new u("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,t,r=0,o=0,i="";t=e.charAt(o++);~t&&(n=r%4?64*n+t:t,r++%4)?i+=String.fromCharCode(255&n>>(-2*r&6)):0)t=a.indexOf(t);return i})}();var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var n=Math.ceil(3*e.length/4),t=new ArrayBuffer(n);return this.decode(e,t),t},decode:function(e,n){var t,r,o,i,a,u,s,c=this._keyStr.indexOf(e.charAt(e.length-1)),l=this._keyStr.indexOf(e.charAt(e.length-1)),d=Math.ceil(3*e.length/4);64==c&&d--,64==l&&d--;var f=0,A=0;for(t=n?new Uint8Array(n):new Uint8Array(d),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),f=0;f<d;f+=3)r=this._keyStr.indexOf(e.charAt(A++))<<2|(a=this._keyStr.indexOf(e.charAt(A++)))>>4,o=(15&a)<<4|(u=this._keyStr.indexOf(e.charAt(A++)))>>2,i=(3&u)<<6|(s=this._keyStr.indexOf(e.charAt(A++))),t[f]=r,64!=u&&(t[f+1]=o),64!=s&&(t[f+2]=i);return t}};