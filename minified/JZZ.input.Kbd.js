!function(){function a(a){return a?a:"Kbd"}function b(a){var b={};for(var c in a)b[c]=a[c];return b}function c(a,b){for(var c in b)a.style[c]=b[c]}function d(a){if("string"!=typeof a)return void 0;var b={C:0,D:1,E:2,F:3,G:4,A:5,B:6}[a.substr(0,1).toUpperCase()];if(void 0===b)return void 0;var c=a.substr(1);if(parseInt(c)!=c)return void 0;var d=7*c+b;return d>=0&&74>=d?d:void 0}function e(a){return 12*Math.floor(a/7)+{0:0,1:2,2:4,3:5,4:7,5:9,6:11}[a%7]}function f(a,b){return function(c){1&c.buttons&&(a.mouseDown=!0,a.mouseMidi=b,a.press(b))}}function g(a,b){return function(c){a.mouseDown&&(a.mouseMidi=b,a.press(b))}}function h(a,b){return function(c){a.mouseDown&&a.release(b)}}function i(a){return function(b){if(!(1&b.buttons)&&a.mouseDown){var c=a.mouseMidi;a.mouseDown=!1,a.release(c)}}}function j(a){this.bins=[],this.params={0:{}};var c={from:"C4",to:"E6",ww:42,bw:24,wl:150,bl:100,pos:"N"};void 0===a&&(a={});var e;for(e in a)if(e==parseInt(e))this.params[e]=b(a[e]);else{if(("from"==e||"to"==e)&&void 0===d(a[e]))continue;c[e]=a[e]}for(e in this.params){this.bins.push(e);for(var f in c)"from"!=f&&"to"!=f||void 0!==d(this.params[e][f])||(this.params[e][f]=c[f]),f in this.params[e]||(this.params[e][f]=c[f]);var g=this.params[e].from,h=this.params[e].to;d(g)>d(h)&&(this.params[e].from=h,this.params[e].to=g)}this.bins.sort(function(a,b){return a-b})}function k(){}if(JZZ){JZZ.input||(JZZ.input={});var l="0.1";j.prototype.press=function(a){c(this.keys[a],this.stl1[a]),c(this.keys[a],this.locs[a]),this.noteOn(a)},j.prototype.release=function(a){c(this.keys[a],this.stl0[a]),c(this.keys[a],this.locs[a]),this.noteOff(a)},j.prototype.create=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current=this.params[a],this.createCurrent()},j.prototype.createCurrent=function(){this.parent&&(this.parent.innerHTML=""),"string"==typeof this.current.parent&&(this.current.parent=document.getElementById(this.current.parent));try{this.createAt(this.current.parent)}catch(a){this.bottom||(this.bottom=document.createElement("div"),document.body.appendChild(this.bottom)),this.createAt(this.bottom)}},j.prototype.createAt=function(a){a.innerHTML="",this.keys={},this.locs={},this.stl0={},this.stl1={};var b,j,k,l=this.current.pos.toUpperCase(),m=d(this.current.from),n=d(this.current.to),o=n-m+1,p=o*this.current.ww+1,q=this.current.wl+1,r=this.current.ww-1,s=this.current.wl-1,t=this.current.bw-1,u=this.current.bl-1,v="N"!=l^!this.current.rev,w="E"!=l^!this.current.rev,x=document.createElement("span");x.style.display="inline-block",x.style.position="relative",x.style.margin="0px",x.style.padding="0px",x.style.borderStyle="none","E"==l||"W"==l?(x.style.width=q+"px",x.style.height=p+"px"):(x.style.width=p+"px",x.style.height=q+"px");for(var y=0;o>y;y++)b=e(y+m),j=document.createElement("span"),this.keys[b]=j,k={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=k,"E"==l||"W"==l?(k.width=s+"px",k.height=r+"px",k.left="0px",k[w?"top":"bottom"]=this.current.ww*y+"px"):(k.width=r+"px",k.height=s+"px",k.top="0px",k[v?"left":"right"]=this.current.ww*y+"px",k.verticalAlign="top"),this.stl0[b]={backgroundColor:"#fff",borderColor:"#000"},this.stl1[b]={backgroundColor:"#aaa",borderColor:"#000"},c(j,this.stl0[b]),c(j,k),x.appendChild(j);var z=Math.ceil(this.current.ww-3*this.current.bw/4);(z+this.current.ww)%2&&z--;var A=e(m)+1,B=e(n);for(b=A;B>b;b++){var C,D=b%12,E=Math.floor(b/12);if(1==D)C=Math.floor(this.current.ww*(7*E+1.5-m))-z/2-this.current.bw;else if(3==D)C=Math.floor(this.current.ww*(7*E+1.5-m)+z/2);else if(6==D)C=this.current.ww*(7*E+5-m)-Math.floor(this.current.bw/2)-z-this.current.bw;else if(8==D)C=this.current.ww*(7*E+5-m)-Math.floor(this.current.bw/2);else{if(10!=D)continue;C=this.current.ww*(7*E+5-m)-Math.floor(this.current.bw/2)+z+this.current.bw}j=document.createElement("span"),this.keys[b]=j,k={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=k,"E"==l||"W"==l?(k.width=u+"px",k.height=t+"px",k["E"==l?"right":"left"]="0px",k[w?"top":"bottom"]=C+"px"):(k.width=t+"px",k.height=u+"px",k["N"==l?"top":"bottom"]="0px",k[v?"left":"right"]=C+"px"),this.stl0[b]={backgroundColor:"#000",borderColor:"#000"},this.stl1[b]={backgroundColor:"#888",borderColor:"#000"},c(j,this.stl0[b]),c(j,k),x.appendChild(j)}a.appendChild(x);for(b in this.keys)this.keys[b].addEventListener("mousedown",f(this,b)),this.keys[b].addEventListener("mouseenter",g(this,b)),this.keys[b].addEventListener("mouseleave",h(this,b)),this.keys[b].ondragstart=function(){return!1};if(window.addEventListener("mouseup",i(this)),!this.parent&&this.bins.length>1){var F=this;this.resize=function(){F.onResize()},window.addEventListener("resize",this.resize)}this.current.parent=a,this.parent=a},j.prototype.onResize=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current!=this.params[a]&&(this.current=this.params[a],this.createCurrent())},j.prototype.destroy=function(){},k.prototype._info=function(b){return{type:"gadget",name:a(b),manufacturer:"virtual",version:l}},k.prototype._openIn=function(a,b){var c=new j(this._arg);c.create(),c.noteOn=function(b){a._event(JZZ.MIDI(144,b,127))},c.noteOff=function(b){a._event(JZZ.MIDI(128,b,127))},a._resume()},JZZ.input.Kbd=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new k;return c._arg=b,JZZ.lib.openMidiIn(a,c)},JZZ.input.Kbd.register=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new k;return c._arg=b,JZZ.lib.registerMidiIn(a,c)}}}();