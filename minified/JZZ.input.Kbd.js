!function(){function a(a){return a?a:"Kbd"}function b(a){var b={};for(var c in a)b[c]=a[c];return b}function c(a,b){for(var c in b)a.style[c]=b[c]}function d(a){if("string"!=typeof a)return void 0;var b={C:0,D:1,E:2,F:3,G:4,A:5,B:6}[a.substr(0,1).toUpperCase()];if(void 0===b)return void 0;var c=a.substr(1);if(parseInt(c)!=c)return void 0;var d=7*c+b;return d>=0&&74>=d?d:void 0}function e(a){return 12*Math.floor(a/7)+{0:0,1:2,2:4,3:5,4:7,5:9,6:11}[a%7]}function f(a,b){return function(c){1&c.buttons&&!a.playing[b]&&(a.mouseDown=!0,a.playing[b]="M",a.press(b))}}function g(a,b){return function(c){a.mouseDown&&!a.playing[b]&&(a.playing[b]="M",a.press(b))}}function h(a,b){return function(c){a.mouseDown&&"M"==a.playing[b]&&(a.playing[b]=void 0,a.release(b))}}function i(a,b){return function(c){1&c.buttons||!a.mouseDown||"M"==a.playing[b]&&(a.playing[b]=void 0,a.release(b))}}function j(a){return function(b){1&b.buttons||(a.mouseDown=!1)}}function k(a){return function(b){b.preventDefault();var c={};for(var d in b.touches)a.findKey(b.touches[d].clientX,b.touches[d].clientY,c);var e={};for(var f in c)f in a.touches?e[f]=!0:void 0===a.playing[f]&&(a.playing[f]="T",a.press(f),e[f]=!0);for(var f in a.touches)f in c||(a.playing[f]=void 0,a.release(f));a.touches=e}}function l(a){this.bins=[],this.params={0:{}};var c={from:"C4",to:"E6",ww:42,bw:24,wl:150,bl:100,pos:"N"};void 0===a&&(a={});var e;for(e in a)if(e==parseInt(e))this.params[e]=b(a[e]);else{if(("from"==e||"to"==e)&&void 0===d(a[e]))continue;c[e]=a[e]}for(e in this.params){this.bins.push(e);for(var f in c)"from"!=f&&"to"!=f||void 0!==d(this.params[e][f])||(this.params[e][f]=c[f]),f in this.params[e]||(this.params[e][f]=c[f]);var g=this.params[e].from,h=this.params[e].to;d(g)>d(h)&&(this.params[e].from=h,this.params[e].to=g)}this.bins.sort(function(a,b){return a-b})}function m(){}if(JZZ){JZZ.input||(JZZ.input={});var n="0.1";l.prototype.press=function(a){c(this.keys[a],this.stl1[a]),c(this.keys[a],this.locs[a]),this.noteOn(a)},l.prototype.release=function(a){c(this.keys[a],this.stl0[a]),c(this.keys[a],this.locs[a]),this.noteOff(a)},l.prototype.findKey=function(a,b,c){var d;for(var e in this.keys){var f=this.keys[e].getBoundingClientRect();if(a>f.left&&a<f.right&&b>f.top&&b<f.bottom){d=e;var g=e%12;if(1==g||3==g||6==g||8==g||10==g)break}}void 0!==d&&(c[d]=!0)},l.prototype.create=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current=this.params[a],this.createCurrent()},l.prototype.createCurrent=function(){this.parent&&(this.parent.innerHTML=""),"string"==typeof this.current.parent&&(this.current.parent=document.getElementById(this.current.parent));try{this.createAt(this.current.parent)}catch(a){this.bottom||(this.bottom=document.createElement("div"),document.body.appendChild(this.bottom)),this.createAt(this.bottom)}},l.prototype.createAt=function(a){a.innerHTML="",this.keys={},this.locs={},this.stl0={},this.stl1={},this.playing={},this.touches={};var b,l,m,n=this.current.pos.toUpperCase(),o=d(this.current.from),p=d(this.current.to),q=p-o+1,r=q*this.current.ww+1,s=this.current.wl+1,t=this.current.ww-1,u=this.current.wl-1,v=this.current.bw-1,w=this.current.bl-1,x="N"!=n^!this.current.rev,y="E"!=n^!this.current.rev,z=document.createElement("span");z.style.display="inline-block",z.style.position="relative",z.style.margin="0px",z.style.padding="0px",z.style.borderStyle="none","E"==n||"W"==n?(z.style.width=s+"px",z.style.height=r+"px"):(z.style.width=r+"px",z.style.height=s+"px");for(var A=0;q>A;A++)b=e(A+o),l=document.createElement("span"),this.keys[b]=l,m={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=m,"E"==n||"W"==n?(m.width=u+"px",m.height=t+"px",m.left="0px",m[y?"top":"bottom"]=this.current.ww*A+"px"):(m.width=t+"px",m.height=u+"px",m.top="0px",m[x?"left":"right"]=this.current.ww*A+"px",m.verticalAlign="top"),this.stl0[b]={backgroundColor:"#fff",borderColor:"#000"},this.stl1[b]={backgroundColor:"#aaa",borderColor:"#000"},c(l,this.stl0[b]),c(l,m),z.appendChild(l);var B=Math.ceil(this.current.ww-3*this.current.bw/4);(B+this.current.ww)%2&&B--;var C=e(o)+1,D=e(p);for(b=C;D>b;b++){var E,F=b%12,G=Math.floor(b/12);if(1==F)E=Math.floor(this.current.ww*(7*G+1.5-o))-B/2-this.current.bw;else if(3==F)E=Math.floor(this.current.ww*(7*G+1.5-o)+B/2);else if(6==F)E=this.current.ww*(7*G+5-o)-Math.floor(this.current.bw/2)-B-this.current.bw;else if(8==F)E=this.current.ww*(7*G+5-o)-Math.floor(this.current.bw/2);else{if(10!=F)continue;E=this.current.ww*(7*G+5-o)-Math.floor(this.current.bw/2)+B+this.current.bw}l=document.createElement("span"),this.keys[b]=l,m={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=m,"E"==n||"W"==n?(m.width=w+"px",m.height=v+"px",m["E"==n?"right":"left"]="0px",m[y?"top":"bottom"]=E+"px"):(m.width=v+"px",m.height=w+"px",m["N"==n?"top":"bottom"]="0px",m[x?"left":"right"]=E+"px"),this.stl0[b]={backgroundColor:"#000",borderColor:"#000"},this.stl1[b]={backgroundColor:"#888",borderColor:"#000"},c(l,this.stl0[b]),c(l,m),z.appendChild(l)}a.appendChild(z);for(b in this.keys)this.keys[b].addEventListener("mousedown",f(this,b)),this.keys[b].addEventListener("mouseenter",g(this,b)),this.keys[b].addEventListener("mouseleave",h(this,b)),this.keys[b].addEventListener("mouseup",i(this,b)),this.keys[b].ondragstart=function(){return!1};window.addEventListener("mouseup",j(this));var H=k(this);if(z.addEventListener("touchstart",H),z.addEventListener("touchmove",H),z.addEventListener("touchend",H),!this.parent&&this.bins.length>1){var I=this;this.resize=function(){I.onResize()},window.addEventListener("resize",this.resize)}this.current.parent=a,this.parent=a},l.prototype.onResize=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current!=this.params[a]&&(this.current=this.params[a],this.createCurrent())},l.prototype.destroy=function(){},m.prototype._info=function(b){return{type:"html/javascript",name:a(b),manufacturer:"virtual",version:n}},m.prototype._openIn=function(a,b){var c=new l(this._arg);c.create(),c.noteOn=function(b){JZZ.util.iosSound(),a._event(JZZ.MIDI(144,b,127))},c.noteOff=function(b){a._event(JZZ.MIDI(128,b,127))},a._resume()},JZZ.input.Kbd=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new m;return c._arg=b,JZZ.lib.openMidiIn(a,c)},JZZ.input.Kbd.register=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new m;return c._arg=b,JZZ.lib.registerMidiIn(a,c)}}}();