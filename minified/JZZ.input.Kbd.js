!function(){function a(a){return a?a:"Kbd"}function b(a){var b={};for(var c in a)b[c]=a[c];return b}function c(a){return void 0===a.buttons?!a.button:1&a.buttons}function d(a){return void 0===a.buttons?!a.button:!(1&a.buttons)}function e(a,b){for(;a;a=a.parentNode)if(a==b)return!0;return!1}function f(){return!1}function g(a,b){for(var c in b)a.style[c]=b[c]}function h(a){if("string"==typeof a){var b={C:0,D:1,E:2,F:3,G:4,A:5,B:6}[a.substr(0,1).toUpperCase()];if(void 0!==b){var c=a.substr(1);if(parseInt(c)==c){var d=7*c+b;return d>=0&&74>=d?d:void 0}}}}function i(a){return 12*Math.floor(a/7)+{0:0,1:2,2:4,3:5,4:7,5:9,6:11}[a%7]}function j(a,b){return function(d){c(d)&&!a.playing[b]&&(a.mouseDown=!0,a.playing[b]="M",a.press(b))}}function k(a,b){return function(c){a.mouseDown&&!a.playing[b]&&(a.playing[b]="M",a.press(b))}}function l(a,b){return function(c){a.mouseDown&&"M"==a.playing[b]&&!e(c.relatedTarget,this)&&(a.playing[b]=void 0,a.release(b))}}function m(a,b){return function(c){d(c)&&a.mouseDown&&"M"==a.playing[b]&&(a.playing[b]=void 0,a.release(b))}}function n(a){return function(b){d(b)&&(a.mouseDown=!1)}}function o(a){return function(b){b.preventDefault();var c={};for(var d in b.touches)a.findKey(b.touches[d].clientX,b.touches[d].clientY,c);var e={};for(var f in c)f in a.touches?e[f]=!0:void 0===a.playing[f]&&(a.playing[f]="T",a.press(f),e[f]=!0);for(var f in a.touches)f in c||(a.playing[f]=void 0,a.release(f));a.touches=e}}function p(a){this.bins=[],this.params={0:{}};var c={from:"C4",to:"E6",ww:42,bw:24,wl:150,bl:100,pos:"N"};void 0===a&&(a={}),this.channel=t[a.channel],void 0===this.channel&&(this.channel=0);var d;for(d in a)if(d==parseInt(d))this.params[d]=b(a[d]);else{if("channel"==d)continue;if(("from"==d||"to"==d)&&void 0===h(a[d]))continue;c[d]=a[d]}for(d in this.params){this.bins.push(d);for(var e in c)"from"!=e&&"to"!=e||void 0!==h(this.params[d][e])||(this.params[d][e]=c[e]),e in this.params[d]||(this.params[d][e]=c[e]);var f=this.params[d].from,g=this.params[d].to;h(f)>h(g)&&(this.params[d].from=g,this.params[d].to=f)}this.bins.sort(function(a,b){return a-b})}function q(a){this.piano=a,this.keys=[]}function r(){}if(JZZ){JZZ.input||(JZZ.input={});for(var s="0.6",t={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},u=0;16>u;u++)t[u]=u;p.prototype._close=function(){for(var a in this.playing)"M"!=this.playing[a]&&"T"!=this.playing[a]||this.noteOff(a);this.parent&&(this.parent.innerHTML=""),this.mouseUpHandler&&window.removeEventListener("mouseup",this.mouseUpHandler)},p.prototype.press=function(a){g(this.keys[a],this.stl1[a]),g(this.keys[a],this.locs[a]),this.noteOn(a)},p.prototype.release=function(a){g(this.keys[a],this.stl0[a]),g(this.keys[a],this.locs[a]),this.noteOff(a)},p.prototype.forward=function(a){var b=a[1];a.getChannel()==this.channel&&(a.isNoteOn()?(this.playing[b]="E",g(this.keys[b],this.stl1[b]),g(this.keys[b],this.locs[b])):a.isNoteOff()&&(this.playing[b]=void 0,g(this.keys[b],this.stl0[b]),g(this.keys[b],this.locs[b]))),this.emit(a)},p.prototype.findKey=function(a,b,c){var d;for(var e in this.keys){var f=this.keys[e].getBoundingClientRect();if(a>f.left&&a<f.right&&b>f.top&&b<f.bottom){d=e;var g=e%12;if(1==g||3==g||6==g||8==g||10==g)break}}void 0!==d&&(c[d]=!0)},p.prototype.create=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current=this.params[a],this.createCurrent()},p.prototype.createCurrent=function(){this.parent&&(this.parent.innerHTML=""),"string"==typeof this.current.parent&&(this.current.parent=document.getElementById(this.current.parent));try{this.createAt(this.current.parent)}catch(a){this.bottom||(this.bottom=document.createElement("div"),document.body.appendChild(this.bottom)),this.createAt(this.bottom)}},p.prototype.createAt=function(a){a.innerHTML="",this.keys={},this.locs={},this.stl0={},this.stl1={},this.playing={},this.touches={};var b,c,d,e=this.current.pos.toUpperCase(),p=h(this.current.from),q=h(this.current.to),r=q-p+1,s=r*this.current.ww+1,t=this.current.wl+1,u=this.current.ww-1,v=this.current.wl-1,w=this.current.bw-1,x=this.current.bl-1,y="N"!=e^!this.current.rev,z="E"!=e^!this.current.rev,A=document.createElement("span");A.style.display="inline-block",A.style.position="relative",A.style.margin="0px",A.style.padding="0px",A.style.borderStyle="none",A.style.userSelect="none",A.style.MozUserSelect="none",A.style.WebkitUserSelect="none",A.style.MsUserSelect="none",A.style.KhtmlUserSelect="none","E"==e||"W"==e?(A.style.width=t+"px",A.style.height=s+"px"):(A.style.width=s+"px",A.style.height=t+"px");for(var B=0;r>B;B++)b=i(B+p),c=document.createElement("span"),this.keys[b]=c,d={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=d,"E"==e||"W"==e?(d.width=v+"px",d.height=u+"px",d.left="0px",d[z?"top":"bottom"]=this.current.ww*B+"px"):(d.width=u+"px",d.height=v+"px",d.top="0px",d[y?"left":"right"]=this.current.ww*B+"px",d.verticalAlign="top"),this.stl0[b]={backgroundColor:"#fff",borderColor:"#000"},this.stl1[b]={backgroundColor:"#aaa",borderColor:"#000"},g(c,this.stl0[b]),g(c,d),A.appendChild(c);var C=Math.ceil(this.current.ww-3*this.current.bw/4);(C+this.current.ww)%2&&C--;var D=i(p)+1,E=i(q);for(b=D;E>b;b++){var F,G=b%12,H=Math.floor(b/12);if(1==G)F=Math.floor(this.current.ww*(7*H+1.5-p))-C/2-this.current.bw;else if(3==G)F=Math.floor(this.current.ww*(7*H+1.5-p)+C/2);else if(6==G)F=this.current.ww*(7*H+5-p)-Math.floor(this.current.bw/2)-C-this.current.bw;else if(8==G)F=this.current.ww*(7*H+5-p)-Math.floor(this.current.bw/2);else{if(10!=G)continue;F=this.current.ww*(7*H+5-p)-Math.floor(this.current.bw/2)+C+this.current.bw}c=document.createElement("span"),this.keys[b]=c,d={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[b]=d,"E"==e||"W"==e?(d.width=x+"px",d.height=w+"px",d["E"==e?"right":"left"]="0px",d[z?"top":"bottom"]=F+"px"):(d.width=w+"px",d.height=x+"px",d["N"==e?"top":"bottom"]="0px",d[y?"left":"right"]=F+"px"),this.stl0[b]={backgroundColor:"#000",borderColor:"#000"},this.stl1[b]={backgroundColor:"#888",borderColor:"#000"},g(c,this.stl0[b]),g(c,d),A.appendChild(c)}this.current.onCreate&&this.current.onCreate.apply(this),a.appendChild(A);var I=void 0===this.current.active||this.current.active;for(b in this.keys)I&&(this.keys[b].addEventListener("mousedown",j(this,b)),this.keys[b].addEventListener("mouseover",k(this,b)),this.keys[b].addEventListener("mouseout",l(this,b)),this.keys[b].addEventListener("mouseup",m(this,b))),this.keys[b].ondragstart=f,this.keys[b].onselectstart=f;if(I){this.mouseUpHandler=n(this),window.addEventListener("mouseup",this.mouseUpHandler);var J=o(this);A.addEventListener("touchstart",J),A.addEventListener("touchmove",J),A.addEventListener("touchend",J)}if(!this.parent&&this.bins.length>1){var K=this;this.resize=function(){K.onResize()},window.addEventListener("resize",this.resize)}this.current.parent=a,this.parent=a},p.prototype.onResize=function(){for(var a=0,b=0;b<this.bins.length&&this.bins[b]<=window.innerWidth;b++)a=this.bins[b];this.current!=this.params[a]&&(this.current=this.params[a],this.createCurrent())},p.prototype.getKey=function(a){var b=new q(this),c=JZZ.MIDI.noteValue(a);return void 0!==this.keys[c]&&b.keys.push(c),b},p.prototype.getKeys=function(a,b){var c=new q(this),d=void 0===a?void 0:JZZ.MIDI.noteValue(a),e=void 0===b?void 0:JZZ.MIDI.noteValue(b);if(void 0!==d&&void 0!==e&&d>e){var f=d;d=e,e=f}for(var g in this.keys)void 0!==d&&d>g||void 0!==e&&g>e||c.keys.push(g);return c},p.prototype.getWhiteKeys=function(a,b){var c=new q(this),d=void 0===a?void 0:JZZ.MIDI.noteValue(a),e=void 0===b?void 0:JZZ.MIDI.noteValue(b);if(void 0!==d&&void 0!==e&&d>e){var f=d;d=e,e=f}for(var g in this.keys)if(!(void 0!==d&&d>g||void 0!==e&&g>e)){var h=g%12;1!=h&&3!=h&&6!=h&&8!=h&&10!=h&&c.keys.push(g)}return c},p.prototype.getBlackKeys=function(a,b){var c=new q(this),d=void 0===a?void 0:JZZ.MIDI.noteValue(a),e=void 0===b?void 0:JZZ.MIDI.noteValue(b);if(void 0!==d&&void 0!==e&&d>e){var f=d;d=e,e=f}for(var g in this.keys)if(!(void 0!==d&&d>g||void 0!==e&&g>e)){var h=g%12;1!=h&&3!=h&&6!=h&&8!=h&&10!=h||c.keys.push(g)}return c},q.prototype.setInnerHTML=function(a){for(var b in this.keys)this.piano.keys[this.keys[b]].innerHTML=a;return this},q.prototype.setStyle=function(a,b){void 0===b&&(b=a);for(var c in this.keys){var d=this.keys[c];for(var e in a)this.piano.stl0[d][e]=a[e];for(var e in b)this.piano.stl1[d][e]=b[e];g(this.piano.keys[d],this.piano.playing[d]?this.piano.stl1[d]:this.piano.stl0[d]),g(this.piano.keys[d],this.piano.locs[d])}return this},r.prototype._info=function(b){return{type:"html/javascript",name:a(b),manufacturer:"virtual",version:s}},r.prototype._openIn=function(a,b){var c=new p(this._arg);c.create(),c.noteOn=function(b){JZZ.util.iosSound(),a._emit(JZZ.MIDI(144,b,127))},c.noteOff=function(b){a._emit(JZZ.MIDI(128,b,127))},c.emit=function(b){a._emit(b)},a._info=this._info(b),a._receive=function(a){c.forward(a)},a._close=function(){c._close()},a.getKey=function(a){return c.getKey(a)},a.getKeys=function(a,b){return c.getKeys(a,b)},a.getWhiteKeys=function(a,b){return c.getWhiteKeys(a,b)},a.getBlackKeys=function(a,b){return c.getBlackKeys(a,b)},a._resume()},JZZ.input.Kbd=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new r;return c._arg=b,JZZ.lib.openMidiIn(a,c)},JZZ.input.Kbd.register=function(){var a,b;1==arguments.length?"string"==typeof arguments[0]?a=arguments[0]:b=arguments[0]:(a=arguments[0],b=arguments[1]);var c=new r;return c._arg=b,JZZ.lib.registerMidiIn(a,c)}}}();