!function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("JZZ",[],e);else{if((t=t||window).JZZ&&t.JZZ.MIDI)return;t.JZZ=e()}}(this,function(){var e,r,t,o,n="undefined"==typeof window?global:window,i="0.6.6",s=Date.now||function(){return(new Date).getTime()},u=s(),a="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return s()-u};function h(){(this._orig=this)._ready=!1,this._queue=[],this._err=[]}function c(t,e){setTimeout(function(){t._resume()},e)}function f(t){t._resume()}function p(t,n,i){t[i]=function(){var t=arguments,e=n._image();return this._push(f,[e]),e[i].apply(e,t)}}function l(t){t instanceof Function?t.apply(this):console.log(t)}function d(t){t instanceof Function?t.apply(this):console.log(t)}function _(t){this._break("closed"),t._resume()}function m(t){if(t.length){var e,n=t.shift();t.length&&(e=this)._slip(d,[function(){m.apply(e,[t])}]);try{this._repair(),n.apply(this)}catch(t){this._break(t.toString())}}else this._break()}function g(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return;t.push(e)}function v(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return void t.splice(n,1)}function y(){h.apply(this)}function C(t,e,n){if(void 0===e)return C(t,[],[]);if(t instanceof Object){for(var i,r,o=0;o<e.length;o++)if(e[o]===t)return n[o];for(r in i=t instanceof Array?[]:{},e.push(t),n.push(i),t)t.hasOwnProperty(r)&&(i[r]=C(t[r],e,n));return i}return t}h.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();this._orig._bad?this._orig._hope&&t[0]==d?(this._orig._hope=!1,t[0].apply(this,t[1])):(this._queue=[],this._orig._hope=!1):t[0]!=d&&t[0].apply(this,t[1])}},h.prototype._push=function(t,e){this._queue.push([t,e]),h.prototype._exec.apply(this)},h.prototype._slip=function(t,e){this._queue.unshift([t,e])},h.prototype._pause=function(){this._ready=!1},h.prototype._resume=function(){this._ready=!0,h.prototype._exec.apply(this)},h.prototype._break=function(t){this._orig._bad=!0,this._orig._hope=!0,t&&this._orig._err.push(t)},h.prototype._repair=function(){this._orig._bad=!1},h.prototype._crash=function(t){this._break(t),this._resume()},h.prototype.err=function(){return C(this._err)},h.prototype._image=function(){var t=function(){};t.prototype=this._orig;t=new t;return t._ready=!1,t._queue=[],t},h.prototype.wait=function(t){if(!t)return this;var e=this._image();return this._push(c,[e,t]),e},h.prototype.and=function(t){return this._push(l,[t]),this},h.prototype.or=function(t){return this._push(d,[t]),this},h.prototype._info={},h.prototype.info=function(){var t=C(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},h.prototype.name=function(){return this.info().name},h.prototype.close=function(){var t=new h;return this._close&&this._push(this._close,[]),this._push(_,[t]),t},(y.prototype=new h)._info={name:"JZZ.js",ver:i,version:i};var S,w=[],M=[];function b(){var t,e;for(this._orig._info.engine=G._type,this._orig._info.version=G._version,this._orig._info.sysex=G._sysex,this._orig._info.inputs=[],this._orig._info.outputs=[],w=[],M=[],G._allOuts={},G._allIns={},t=0;t<G._outs.length;t++)((e=G._outs[t]).engine=G)._allOuts[e.name]=e,this._orig._info.outputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:G._type}),w.push(e);for(t=0;t<V._outs.length;t++)e=V._outs[t],this._orig._info.outputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),w.push(e);for(t=0;t<G._ins.length;t++)((e=G._ins[t]).engine=G)._allIns[e.name]=e,this._orig._info.inputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:G._type}),M.push(e);for(t=0;t<V._ins.length;t++)e=V._ins[t],this._orig._info.inputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),M.push(e)}function A(){this._slip(b,[]),G._refresh(this)}function I(t,e){var n;t instanceof Function&&(t=t(e)),t instanceof Array||(t=[t]);for(var i=[],r=[],o=e.slice(),s=i,u=0;u<t.length;u++)if(void 0===t[u])s=r;else if(t[u]instanceof RegExp)for(n=0;n<o.length;n++)t[u].test(o[n].name)&&(s.push(o[n]),o.splice(n,1),n--);else for(n=0;n<o.length;n++)(t[u]+""==n+""||t[u]===o[n].name||t[u]instanceof Object&&t[u].name===o[n].name)&&(s.push(o[n]),o.splice(n,1),n--);return s==i?i:i.concat(o).concat(r)}function O(t,e){e=e instanceof RegExp?"Port matching "+e+" not found":e instanceof Object||void 0===e?"Port not found":'Port "'+e+'" not found';t._crash(e)}function E(t,e){var n=I(e,w);if(n.length){for(var i=0;i<n.length;i++)n[i]=function(t){return function(){t.engine._openOut(this,t.name)}}(n[i]);t._slip(m,[n]),t._resume()}else O(t,e)}function B(t,e){var n=I(e,M);if(n.length){for(var i=0;i<n.length;i++)n[i]=function(t){return function(){t.engine._openIn(this,t.name)}}(n[i]);t._slip(m,[n]),t._resume()}else O(t,e)}function P(t,e){t._slip(j,[e]),t._resume()}function x(){h.apply(this),this._handles=[],this._outs=[]}function T(t){this._receive(t)}function F(t){this._emit(t)}function D(t){t instanceof Function?g(this._orig._handles,t):g(this._orig._outs,t)}function q(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):t instanceof Function?v(this._orig._handles,t):v(this._orig._outs,t)}function k(t,e){this._orig._mpe||(this._orig._mpe=new Tt),this._orig._mpe.setup(t,e)}function L(t,e){x.apply(this),this._port=t._orig,this._chan=e,p(this,this._port,"ch"),p(this,this._port,"mpe"),p(this,this._port,"connect"),p(this,this._port,"disconnect"),p(this,this._port,"close")}function z(t,e,n){x.apply(this),this._port=t._orig,this._master=e,this._band=n,p(this,this._port,"ch"),p(this,this._port,"mpe"),p(this,this._port,"connect"),p(this,this._port,"disconnect"),p(this,this._port,"close")}function N(){h.apply(this),this._handles=[],p(this,S,"refresh"),p(this,S,"openMidiOut"),p(this,S,"openMidiIn"),p(this,S,"onChange"),p(this,S,"close")}function j(t){t instanceof Function&&(this._orig._handles.length||G._watch(),g(this._orig._handles,t))}function R(t){void 0===t?this._orig._handles=[]:v(this._orig._handles,t),this._orig._handles.length||G._unwatch()}function W(t,e,n,i){if(function(t,e,n,i){var r;if(t.length!=n.length||e.length!=i.length)return 1;for(r=0;r<t.length;r++)if(t[r].name!=n[r].name)return 1;for(r=0;r<e.length;r++)if(e[r].name!=i[r].name)return 1}(t,e,n,i)){for(var r=[],o=[],s=[],u=[],a={},h=0;h<t.length;h++)a[t[h].name]=!0;for(h=0;h<n.length;h++)a[n[h].name]||r.push(n[h]);for(a={},h=0;h<n.length;h++)a[n[h].name]=!0;for(h=0;h<t.length;h++)a[t[h].name]||s.push(t[h]);for(a={},h=0;h<e.length;h++)a[e[h].name]=!0;for(h=0;h<i.length;h++)a[i[h].name]||o.push(i[h]);for(a={},h=0;h<i.length;h++)a[i[h].name]=!0;for(h=0;h<e.length;h++)a[e[h].name]||u.push(e[h]);return r.length||s.length||o.length||u.length?{inputs:{added:r,removed:s},outputs:{added:o,removed:u}}:void 0}}function U(t){for(e=0;e<S._watcher._handles.length;e++)S._watcher._handles[e].apply(S,[t])}y.prototype.refresh=function(){return this._push(A,[]),this},y.prototype.openMidiOut=function(t){var e=new x;return this._push(A,[]),this._push(E,[e,t]),e},y.prototype.openMidiIn=function(t){var e=new x;return this._push(A,[]),this._push(B,[e,t]),e},y.prototype.onChange=function(t){this._orig._watcher||(this._orig._watcher=new N);var e=this._orig._watcher._image();return this._push(P,[e,t]),e},y.prototype._close=function(){G._close()},(x.prototype=new h)._filter=function(t){var e,n;return this._orig._mpe&&(n=0,this._handles&&this._handles.length&&(n=this._handles.length,e=this._handles[0]),this._outs&&this._outs.length&&(n=this._outs.length,e=this._outs[0]),1!=n||e._mpe||(t=this._orig._mpe.filter(t))),t},x.prototype._receive=function(t){this._emit(this._filter(t))},x.prototype.send=function(){return this._push(T,[ut.apply(null,arguments)]),this},x.prototype.note=function(t,e,n,i){return this.noteOn(t,e,n),0<i&&this.wait(i).noteOff(t,e),this},x.prototype._emit=function(t){for(var e=0;e<this._handles.length;e++)this._handles[e].apply(this,[ut(t)._stamp(this)]);for(e=0;e<this._outs.length;e++){var n=ut(t);n._stamped(this._outs[e])||this._outs[e].send(n._stamp(this))}},x.prototype.emit=function(t){return this._push(F,[t]),this},x.prototype.connect=function(t){return this._push(D,[t]),this},x.prototype.disconnect=function(t){return this._push(q,[t]),this},x.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},x.prototype.ch=function(t){if(void 0===t)return this;if(t!=parseInt(t)||t<0||15<t)throw RangeError("Bad channel value: "+t+" (must be from 0 to 15)");t=new L(this,t);return this._push(f,[t]),t},x.prototype.mpe=function(t,e){if(void 0===t&&void 0===e)return this;Tt.validate(t,e);var n=e?new z(this,t,e):new L(this,t);return this._push(k,[t,e]),this._push(f,[n]),n},(L.prototype=new x).channel=function(){return this._chan},L.prototype._receive=function(t){this._port._receive(t)},L.prototype.note=function(t,e,n){return this.noteOn(t,e),n&&this.wait(n).noteOff(t),this},(z.prototype=new x).channel=function(){return this._master},z.prototype._receive=function(t){this._port._receive(t)},z.prototype.note=function(t,e,n){return this.noteOn(t,e),n&&this.wait(n).noteOff(t),this},(N.prototype=new h).connect=function(t){return this._push(j,[t]),this},N.prototype.disconnect=function(t){return this._push(R,[t]),this};var G={},V={_outs:[],_ins:[]};function J(){if("undefined"!=typeof module&&module.exports)return t=require("jazz-midi"),G._type="node",G._main=t,G._pool=[],G._newPlugin=function(){return new t.MIDI},void tt();var t;this._break()}function Z(){var t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);var e,t=document.createElement("object");if(t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz)return e=t,G._type="plugin",G._main=e,G._pool=[e],G._newPlugin=function(){var t=document.createElement("object");return t.style.visibility="hidden",t.style.width="0px",e.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz?t:void 0},void tt();this._break()}function H(){if(navigator.requestMIDIAccess&&navigator.requestMIDIAccess!=nt.requestMIDIAccess){var e=this;return navigator.requestMIDIAccess({}).then(function(t){et(t),e._resume()},function(t){e._crash(t)}),void this._pause()}this._break()}function Q(){if(navigator.requestMIDIAccess){var e=this;return navigator.requestMIDIAccess({sysex:!0}).then(function(t){et(t,!0),e._resume()},function(t){e._crash(t)}),void this._pause()}this._break()}function K(){var s,u,a=this;this._pause(),document.addEventListener("jazz-midi-msg",function t(e){if(s=!0,u=u||document.getElementById("jazz-midi-msg")){var n,i,h,r=[];try{r=JSON.parse(u.innerText)}catch(t){}u.innerText="",document.removeEventListener("jazz-midi-msg",t),"version"===r[0]?(n=u,i=r[2],G._type="extension",G._version=i,G._sysex=!0,G._pool=[],G._outs=[],G._ins=[],G._inArr=[],G._outArr=[],G._inMap={},G._outMap={},G._outsW=[],G._insW=[],G.refreshClients=[],G._msg=n,G._newPlugin=function(){var t={id:G._pool.length};t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0,G._pool.push(t)},G._newPlugin(),G._refresh=function(t){G.refreshClients.push(t),t._pause(),setTimeout(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},0)},G._openOut=function(t,e){var n,i=G._outMap[e];i||(G._pool.length<=G._outArr.length&&G._newPlugin(),n=G._pool[G._outArr.length],((i={name:e,clients:[],info:{name:e,manufacturer:G._allOuts[e].manufacturer,version:G._allOuts[e].version,type:"MIDI-out",sysex:G._sysex,engine:G._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",n.id,e]}))},_close:function(t){G._closeOut(t)},_closeAll:o,_receive:function(t){t.length&&((t=t.slice()).splice(0,0,"play",n.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:t})))}}).plugin=n).output=i,G._outArr.push(i),G._outMap[e]=i),g((t._orig._impl=i).clients,t._orig),t._info=i.info,t._receive=function(t){i._receive(t)},t._close=function(){i._close(this)},i.open||(i.plugin.ready&&i._start(),t._pause())},G._openIn=function(t,e){var n,i=G._inMap[e];i||(G._pool.length<=G._inArr.length&&G._newPlugin(),n=G._pool[G._inArr.length],((i={name:e,clients:[],info:{name:e,manufacturer:G._allIns[e].manufacturer,version:G._allIns[e].version,type:"MIDI-in",sysex:G._sysex,engine:G._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",n.id,e]}))},_close:function(t){G._closeIn(t)},_closeAll:o}).plugin=n).input=i,G._inArr.push(i),G._inMap[e]=i),g((t._orig._impl=i).clients,t._orig),t._info=i.info,t._close=function(){i._close(this)},i.open||(i.plugin.ready&&i._start(),t._pause())},G._closeOut=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",e.plugin.id]})))},G._closeIn=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",e.plugin.id]})))},G._close=function(){},G._watch=function(){G._insW=G._ins,G._outsW=G._outs,h=setInterval(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},250)},G._unwatch=function(){clearInterval(h),h=void 0},document.addEventListener("jazz-midi-msg",function(t){var e,n,i,r=G._msg.innerText.split("\n");for(G._msg.innerText="",n=0;n<r.length;n++){var o=[];try{o=JSON.parse(r[n])}catch(t){}if(o.length)if("refresh"===o[0]){if(o[1].ins){for(i=0;i<o[1].ins.length;i++)o[1].ins[i].type=G._type;G._ins=o[1].ins}if(o[1].outs){for(i=0;i<o[1].outs.length;i++)o[1].outs[i].type=G._type;G._outs=o[1].outs}for(i=0;i<G.refreshClients.length;i++)G.refreshClients[i]._resume();G.refreshClients=[];var s=W(G._insW,G._outsW,G._ins,G._outs);if(s){for(G._insW=G._ins,G._outsW=G._outs,i=0;i<s.inputs.removed.length;i++)(e=G._inMap[s.inputs.removed[i].name])&&e._closeAll();for(i=0;i<s.outputs.removed.length;i++)(e=G._outMap[s.outputs.removed[i].name])&&e._closeAll();h&&U(s)}}else if("version"===o[0]){var u=G._pool[o[1]];u&&(u.ready=!0,u.input&&u.input._start(),u.output&&u.output._start())}else if("openout"===o[0]){if(e=G._pool[o[1]].output)if(o[2]==e.name){if(e.open=!0,e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._resume()}else if(e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._crash()}else if("openin"===o[0]){if(e=G._pool[o[1]].input)if(o[2]==e.name){if(e.open=!0,e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._resume()}else if(e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._crash()}else if("midi"===o[0]&&(e=G._pool[o[1]].input)&&e.clients)for(i=0;i<e.clients.length;i++){var a=ut(o.slice(3));e.clients[i]._emit(a)}}}),a._resume()):a._crash()}function o(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}});try{document.dispatchEvent(new Event("jazz-midi"))}catch(t){}window.setTimeout(function(){s||a._crash()},0)}function $(){this._pause();var t=this;setTimeout(function(){t._crash()},0)}function X(t){for(var e=[J,$],n=function(t){var e=["extension","plugin","webmidi"];if(!t||!t.engine)return e;var n,i,r,o=t.engine instanceof Array?t.engine:[t.engine],s={},u=[],a=[];for(r=0;r<o.length;r++){var h=o[r].toString().toLowerCase();s[h]||(s[h]=!0,"none"===h&&(n=!0),"etc"!==h&&void 0!==h||(i=!0),(i?a:u).push(h),v(e,h))}(i||u.length||a.length)&&(n=!1);return n?[]:u.concat(i?e:a)}(t),i=0;i<n.length;i++)"webmidi"==n[i]?(t&&!0===t.sysex&&e.push(Q),t&&!0===t.sysex&&!0!==t.degrade||e.push(H)):"extension"==n[i]?e.push(K):"plugin"==n[i]&&e.push(Z);return e.push(Y),e}function Y(){G._type="none",G._sysex=!0,G._refresh=function(){G._outs=[],G._ins=[]},G._watch=function(){},G._unwatch=function(){}}function tt(){var i;function o(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}function e(){i&&(G._refresh(),i=!1)}function t(t){i=!0,setTimeout(e,0)}G._inArr=[],G._outArr=[],G._inMap={},G._outMap={},G._outsW=[],G._insW=[],G._version=G._main.version,G._sysex=!0,G._refresh=function(){var t,e;for(G._outs=[],G._ins=[],t=0;(e=G._main.MidiOutInfo(t)).length;t++)G._outs.push({type:G._type,name:e[0],manufacturer:e[1],version:e[2]});for(t=0;(e=G._main.MidiInInfo(t)).length;t++)G._ins.push({type:G._type,name:e[0],manufacturer:e[1],version:e[2]});var n=W(G._insW,G._outsW,G._ins,G._outs);if(n){for(r=0;r<n.inputs.removed.length;r++)impl=G._inMap[n.inputs.removed[r].name],impl&&impl._closeAll();for(r=0;r<n.outputs.removed.length;r++)impl=G._outMap[n.outputs.removed[r].name],impl&&impl._closeAll();G._insW=G._ins,G._outsW=G._outs,i&&U(n)}},G._openOut=function(t,e){var n=G._outMap[e];if(n||(G._pool.length<=G._outArr.length&&G._pool.push(G._newPlugin()),n={name:e,clients:[],info:{name:e,manufacturer:G._allOuts[e].manufacturer,version:G._allOuts[e].version,type:"MIDI-out",sysex:G._sysex,engine:G._type},_close:function(t){G._closeOut(t)},_closeAll:o,_receive:function(t){t.length&&this.plugin.MidiOutRaw(t.slice())}},i=G._pool[G._outArr.length],n.plugin=i,G._outArr.push(n),G._outMap[e]=n),!n.open){var i=n.plugin.MidiOutOpen(e);if(i!==e)return i&&n.plugin.MidiOutClose(),void t._break();n.open=!0}g((t._orig._impl=n).clients,t._orig),t._info=n.info,t._receive=function(t){n._receive(t)},t._close=function(){n._close(this)}},G._openIn=function(t,e){var n,i=G._inMap[e];if(i||(G._pool.length<=G._inArr.length&&G._pool.push(G._newPlugin()),(i={name:e,clients:[],info:{name:e,manufacturer:G._allIns[e].manufacturer,version:G._allIns[e].version,type:"MIDI-in",sysex:G._sysex,engine:G._type},_close:function(t){G._closeIn(t)},_closeAll:o,handle:function(t,e){for(var n=0;n<this.clients.length;n++){var i=ut(e);this.clients[n]._emit(i)}}}).onmidi=(n=i,function(t,e){n.handle(t,e)}),r=G._pool[G._inArr.length],i.plugin=r,G._inArr.push(i),G._inMap[e]=i),!i.open){var r=i.plugin.MidiInOpen(e,i.onmidi);if(r!==e)return r&&i.plugin.MidiInClose(),void t._break();i.open=!0}g((t._orig._impl=i).clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}},G._closeOut=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.open=!1,e.plugin.MidiOutClose())},G._closeIn=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.open=!1,e.plugin.MidiInClose())},G._close=function(){for(var t=0;t<G._inArr.length;t++)G._inArr[t].open&&G._inArr[t].plugin.MidiInClose();G._unwatch()},G._watch=function(){G._main.OnConnectMidiIn(t),G._main.OnConnectMidiOut(t),G._main.OnDisconnectMidiIn(t),G._main.OnDisconnectMidiOut(t)},G._unwatch=function(){G._main.OnConnectMidiIn(),G._main.OnConnectMidiOut(),G._main.OnDisconnectMidiIn(),G._main.OnDisconnectMidiOut()}}function et(t,e){var n;function o(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}G._type="webmidi",G._version=43,G._sysex=!!e,G._access=t,G._inMap={},G._outMap={},G._outsW=[],G._insW=[],G._refresh=function(){G._outs=[],G._ins=[],G._access.outputs.forEach(function(t,e){G._outs.push({type:G._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),G._access.inputs.forEach(function(t,e){G._ins.push({type:G._type,name:t.name,manufacturer:t.manufacturer,version:t.version})});var t=W(G._insW,G._outsW,G._ins,G._outs);if(t){for(r=0;r<t.inputs.removed.length;r++)impl=G._inMap[t.inputs.removed[r].name],impl&&impl._closeAll();for(r=0;r<t.outputs.removed.length;r++)impl=G._outMap[t.outputs.removed[r].name],impl&&impl._closeAll();G._insW=G._ins,G._outsW=G._outs,n&&U(t)}},G._openOut=function(t,n){var i,e=(e=G._outMap[n])||{name:n,clients:[],info:{name:n,manufacturer:G._allOuts[n].manufacturer,version:G._allOuts[n].version,type:"MIDI-out",sysex:G._sysex,engine:G._type},_close:function(t){G._closeOut(t)},_closeAll:o,_receive:function(t){e.dev&&t.length&&this.dev.send(t.slice())}};G._access.outputs.forEach(function(t,e){t.name===n&&(i=t)}),i?(e.dev=i,(G._outMap[n]=e).dev.open&&e.dev.open(),g((t._orig._impl=e).clients,t._orig),t._info=e.info,t._receive=function(t){e._receive(t)},t._close=function(){e._close(this)}):t._break()},G._openIn=function(t,n){var i,e,r=(r=G._inMap[n])||{name:n,clients:[],info:{name:n,manufacturer:G._allIns[n].manufacturer,version:G._allIns[n].version,type:"MIDI-in",sysex:G._sysex,engine:G._type},_close:function(t){G._closeIn(t)},_closeAll:o,handle:function(t){for(var e=0;e<this.clients.length;e++){var n=ut([].slice.call(t.data));this.clients[e]._emit(n)}}};G._access.inputs.forEach(function(t,e){t.name===n&&(i=t)}),i?(r.dev=i,r.dev.onmidimessage=(e=r,function(t){e.handle(t)}),(G._inMap[n]=r).dev.open&&r.dev.open(),g((t._orig._impl=r).clients,t._orig),t._info=r.info,t._close=function(){r._close(this)}):t._break()},G._closeOut=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.dev&&e.dev.close&&e.dev.close(),e.dev=void 0)},G._closeIn=function(t){var e=t._impl;v(e.clients,t._orig),e.clients.length||(e.dev&&e.dev.close&&e.dev.close(),e.dev=void 0)},G._close=function(){},G._watch=function(){G._access.onstatechange=function(){n=!0,setTimeout(function(){n&&(G._refresh(),n=!1)},0)}},G._unwatch=function(){G._access.onstatechange=void 0}}var nt=function(t){return S||(t=t,Ft(),(S=new y)._options=t,S._push(m,[X(t)]),S.refresh(),S._resume()),S};function it(){var t=this instanceof it?this:t=new it;return it.prototype.reset.apply(t,arguments),t}function rt(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function ot(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function st(t){for(var e,n=[],i=0;i<t.length;i++)n[i]=(e=t[i])<10?"0"+e:e;return n.join(":")}function ut(t){var e=this instanceof ut?this:e=new ut;if(t instanceof ut){for(i in e._from=t._from.slice(),t)t.hasOwnProperty(i)&&"_from"!=i&&(e[i]=t[i]);return e}if(e._from=[],void 0===t)return e;for(var n=t instanceof Array?t:arguments,i=0;i<n.length;i++)o=n[i],1==i&&(128<=e[0]&&e[0]<=175&&(o=ut.noteValue(o)),192<=e[0]&&e[0]<=207&&(o=ut.programValue(o))),(o!=parseInt(o)||o<0||255<o)&&ct(n[i]),e.push(o);return e}nt.info=function(){return y.prototype.info()},nt.Widget=function(t){var e=new x;if(t instanceof Object)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e._resume(),e},y.prototype.Widget=nt.Widget,it.prototype.reset=function(t){if(t instanceof it)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;t=t instanceof Array?t:arguments;return this.setType(t[0]),this.setHour(t[1]),this.setMinute(t[2]),this.setSecond(t[3]),this.setFrame(t[4]),this.setQuarter(t[5]),this},it.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},it.prototype.getType=function(){return this.type},it.prototype.getHour=function(){return this.hour},it.prototype.getMinute=function(){return this.minute},it.prototype.getSecond=function(){return this.second},it.prototype.getFrame=function(){return this.frame},it.prototype.getQuarter=function(){return this.quarter},it.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,rt.apply(this);else{if(30!=t)throw RangeError("Bad SMPTE frame rate: "+t);this.type=30}return this.frame>=this.type&&(this.frame=29.97==this.type?29:this.type-1),this},it.prototype.setHour=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||24<=t)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},it.prototype.setMinute=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||60<=t)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,rt.apply(this),this},it.prototype.setSecond=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||60<=t)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,rt.apply(this),this},it.prototype.setFrame=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,rt.apply(this),this},it.prototype.setQuarter=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||8<=t)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},it.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,60<=this.second&&(this.second=0,this.minute++,60<=this.minute&&(this.minute=0,this.hour=23<=this.hour?0:this.hour+1))),rt.apply(this),this},it.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},it.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},it.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},it.prototype.read=function(t){if(t instanceof ut||(t=ut.apply(null,arguments)),240==t[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9])return this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,!(this._f=void 0);if(241!=t[0]||void 0===t[1])return!1;var e=t[1]>>4,t=15&t[1];return 0==e?7==this._&&(7==this._f&&(this.reset(ot(this._a)),this.incrFrame()),this.incrFrame()):3==e?4==this._&&this.decrFrame():4==e?3==this._&&this.incrFrame():7==e&&0===this._&&(0===this._b&&(this.reset(ot(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[e]=t,this._f=this._f===e-1||0==e?e:void 0,this._b=this._b===1+e||7==e?e:void 0,this._=e,this.quarter=e,!0},it.prototype.toString=function(){return st([this.hour,this.minute,this.second,this.frame])},nt.SMPTE=it,ut.prototype=[],ut.prototype.constructor=ut;var at={};ut.noteValue=function(t){return void 0===t?void 0:at[t.toString().toLowerCase()]},ut.programValue=function(t){return t},ut.freq=function(t,e){return void 0===e&&(e=440),e*Math.pow(2,(pt(ut.noteValue(t),t)-69)/12)};var ht={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(At in ht)if(ht.hasOwnProperty(At))for(o=0;o<12&&!(127<(t=ht[At]+12*o));o++)0<(at[At+o]=t)&&(at[At+"b"+o]=t-1,at[At+"bb"+o]=t-2),t<127&&(at[At+"#"+o]=t+1,at[At+"##"+o]=t+2);for(o=0;o<128;o++)at[o]=o;function ct(t){throw RangeError("Bad MIDI value: "+t)}function ft(t){return(t!=parseInt(t)||t<0||15<t)&&ct(t),parseInt(t)}function pt(t,e){return(t!=parseInt(t)||t<0||127<t)&&ct(void 0===e?t:e),parseInt(t)}function lt(t){return(t!=parseInt(t)||t<0||16383<t)&&ct(t),127&parseInt(t)}function dt(t){return(t!=parseInt(t)||t<0||16383<t)&&ct(t),parseInt(t)>>7}function _t(t){t=""+t;for(var e=0;e<t.length;e++)255<t.charCodeAt(e)&&ct(t[e]);return t}var mt={noteOff:function(t,e,n){return void 0===n&&(n=64),[128+ft(t),pt(ut.noteValue(e),e),pt(n)]},noteOn:function(t,e,n){return void 0===n&&(n=127),[144+ft(t),pt(ut.noteValue(e),e),pt(n)]},aftertouch:function(t,e,n){return[160+ft(t),pt(ut.noteValue(e),e),pt(n)]},control:function(t,e,n){return[176+ft(t),pt(e),pt(n)]},program:function(t,e){return[192+ft(t),pt(ut.programValue(e),e)]},pressure:function(t,e){return[208+ft(t),pt(e)]},pitchBend:function(t,e){return[224+ft(t),lt(e),dt(e)]},bankMSB:function(t,e){return[176+ft(t),0,pt(e)]},bankLSB:function(t,e){return[176+ft(t),32,pt(e)]},modMSB:function(t,e){return[176+ft(t),1,pt(e)]},modLSB:function(t,e){return[176+ft(t),33,pt(e)]},breathMSB:function(t,e){return[176+ft(t),2,pt(e)]},breathLSB:function(t,e){return[176+ft(t),34,pt(e)]},footMSB:function(t,e){return[176+ft(t),4,pt(e)]},footLSB:function(t,e){return[176+ft(t),36,pt(e)]},portamentoMSB:function(t,e){return[176+ft(t),5,pt(e)]},portamentoLSB:function(t,e){return[176+ft(t),37,pt(e)]},volumeMSB:function(t,e){return[176+ft(t),7,pt(e)]},volumeLSB:function(t,e){return[176+ft(t),39,pt(e)]},balanceMSB:function(t,e){return[176+ft(t),8,pt(e)]},balanceLSB:function(t,e){return[176+ft(t),40,pt(e)]},panMSB:function(t,e){return[176+ft(t),10,pt(e)]},panLSB:function(t,e){return[176+ft(t),42,pt(e)]},expressionMSB:function(t,e){return[176+ft(t),11,pt(e)]},expressionLSB:function(t,e){return[176+ft(t),43,pt(e)]},damper:function(t,e){return[176+ft(t),64,e?127:0]},portamento:function(t,e){return[176+ft(t),65,e?127:0]},sostenuto:function(t,e){return[176+ft(t),66,e?127:0]},soft:function(t,e){return[176+ft(t),67,e?127:0]},allSoundOff:function(t){return[176+ft(t),120,0]},allNotesOff:function(t){return[176+ft(t),123,0]}},gt={mtc:function(t){return[241,function(t){var e;switch(!t.backwards&&4<=t.quarter?t.decrFrame():t.backwards&&t.quarter<4&&t.incrFrame(),t.quarter>>1){case 0:e=t.frame;break;case 1:e=t.second;break;case 2:e=t.minute;break;default:e=t.hour}return 1&t.quarter?e>>=4:e&=15,7==t.quarter&&(25==t.type?e|=2:29.97==t.type?e|=4:30==t.type&&(e|=6)),!t.backwards&&4<=t.quarter?t.incrFrame():t.backwards&&t.quarter<4&&t.decrFrame(),e|t.quarter<<4}(t)]},songPosition:function(t){return[242,lt(t),dt(t)]},songSelect:function(t){return[243,pt(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},sxIdRequest:function(){return[240,126,127,6,1,247]},sxFullFrame:function(t){return[240,127,127,1,1,25==(e=t).type?32|e.hour:29.97==e.type?64|e.hour:30==e.type?96|e.hour:e.hour,t.getMinute(),t.getSecond(),t.getFrame(),247];var e},reset:function(){return[255]}};function vt(t,e){var n=new ut;return n.ff=pt(t),n.dd=void 0===e?"":_t(e),n}var yt={smf:function(t){if(t instanceof ut)return new ut(t);var e=t instanceof Array?t:arguments,n=pt(e[0]),t="";2==e.length?t=Ot(e[1]):2<e.length&&(t=Ot(Array.prototype.slice.call(e,1)));e={0:yt.smfSeqNumber,32:yt.smfChannelPrefix,47:yt.smfEndOfTrack,81:yt.smfTempo,84:yt.smfSMPTE,88:yt.smfTimeSignature,89:yt.smfKeySignature,127:yt.smfMetaEvent}[n];return e?e(void 0===t?"":_t(t)):vt(n,t)},smfSeqNumber:function(t){if(t==parseInt(t)){if(t<0||65535<t)throw RangeError("Sequence number out of range: "+t);t=String.fromCharCode(t>>8)+String.fromCharCode(255&t)}else if(0==(t=""+t).length)t="\0\0";else if(1==t.length)t="\0"+t;else if(2<t.length)throw RangeError("Sequence number out of range: "+xt(t));return vt(0,t)},smfText:function(t){return vt(1,nt.lib.toUTF8(t))},smfCopyright:function(t){return vt(2,nt.lib.toUTF8(t))},smfSeqName:function(t){return vt(3,nt.lib.toUTF8(t))},smfInstrName:function(t){return vt(4,nt.lib.toUTF8(t))},smfLyric:function(t){return vt(5,nt.lib.toUTF8(t))},smfMarker:function(t){return vt(6,nt.lib.toUTF8(t))},smfCuePoint:function(t){return vt(7,nt.lib.toUTF8(t))},smfProgName:function(t){return vt(8,nt.lib.toUTF8(t))},smfDevName:function(t){return vt(9,nt.lib.toUTF8(t))},smfChannelPrefix:function(t){if(t==parseInt(t)){if(t<0||15<t)throw RangeError("Channel number out of range: "+t);t=String.fromCharCode(t)}else if(0==(t=""+t).length)t="\0";else if(1<t.length||15<t.charCodeAt(0))throw RangeError("Channel number out of range: "+xt(t));return vt(32,t)},smfEndOfTrack:function(t){if(""!=Ot(t))throw RangeError("Unexpected data: "+xt(Ot(t)));return vt(47)},smfTempo:function(t){if(3==(""+t).length)return vt(81,t);if(t==parseInt(t)&&0<t&&t<=16777215)return vt(81,String.fromCharCode(t>>16)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t));throw RangeError("Out of range: "+xt(Ot(t)))},smfBPM:function(t){return yt.smfTempo(Math.round(6e7/t))},smfSMPTE:function(t){if(t instanceof it)return vt(84,String.fromCharCode(t.hour)+String.fromCharCode(t.minute)+String.fromCharCode(t.second)+String.fromCharCode(t.frame)+String.fromCharCode(t.quarter%4*25));if(5==(""+t).length)return vt(84,t);t=t instanceof Array?t:Array.prototype.slice.call(arguments);return t.splice(0,0,30),yt.smfSMPTE(new it(t))},smfTimeSignature:function(t,e,n,i){var r,o,s,u,a=(""+t).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(a){if(r=parseInt(a[1]),o=parseInt(a[2]),0<r&&r<=255&&!(o&o-1)){for(s=o,o=0,s>>=1;s;s>>=1)o++;return s=e==parseInt(e)?e:24,u=n==parseInt(n)?n:8,vt(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return vt(88,t)}else{if(!(t!=parseInt(t)||e!=parseInt(e)||e&e-1)){for(r=t,o=0,s=e,s>>=1;s;s>>=1)o++;return s=n==parseInt(n)?n:24,u=i==parseInt(i)?i:8,vt(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return vt(88,t)}throw RangeError("Wrong time signature: "+xt(Ot(t)))},smfKeySignature:function(t){var e,n=(t=""+t).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(n&&(e={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[n[1].toUpperCase()],n={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[n[2].toUpperCase()],void 0!==e&&void 0!==n&&(n&&(e-=3),-7<=(e-=7)&&e<0?t=String.fromCharCode(256+e)+String.fromCharCode(n):0<=e&&e<=7&&(t=String.fromCharCode(e)+String.fromCharCode(n)))),2==t.length&&t.charCodeAt(1)<=1&&(t.charCodeAt(0)<=7||t.charCodeAt(0)<=255&&249<=t.charCodeAt(0)))return vt(89,t);throw RangeError("Incorrect key signature: "+xt(t))},smfMetaEvent:function(t){return vt(127,Ot(t))}};function Ct(t,e,n){t.prototype[e]=function(){return this.send(n.apply(0,arguments)),this}}function St(t,e){ut[t]=function(){return new ut(e.apply(0,arguments))}}for(At in gt)gt.hasOwnProperty(At)&&St(At,gt[At]);for(At in yt)yt.hasOwnProperty(At)&&function(t,e){ut[t]=function(){return e.apply(0,arguments)}}(At,yt[At]);for(At in mt)mt.hasOwnProperty(At)&&function(t,n){St(t,n),z.prototype[t]=function(){var t,e=Array.prototype.slice.call(arguments);e.length<n.length?e=[this._master].concat(e):(t=pt(ut.noteValue(e[0],e[0])),e[0]=this._master);e=n.apply(0,e);return e.mpe=t,this.send(e),this}}(At,mt[At]);function wt(t,e){for(At in gt)gt.hasOwnProperty(At)&&Ct(t,At,gt[At]);for(At in yt)yt.hasOwnProperty(At)&&Ct(t,At,yt[At]);for(At in mt)mt.hasOwnProperty(At)&&Ct(t,At,mt[At]);if(e)for(At in mt)mt.hasOwnProperty(At)&&function(t,e,n){t.prototype[e]=function(){return this.send(n.apply(0,[this._chan].concat(Array.prototype.slice.call(arguments)))),this}}(e,At,mt[At])}wt(x,L),z.prototype.noteOn=function(t,e){e=ut.noteOn(this._master,t,e);return e._mpe=e[1],this.send(e),this},z.prototype.noteOff=function(t,e){e=ut.noteOff(this._master,t,e);return e._mpe=e[1],this.send(e),this},z.prototype.aftertouch=function(t,e){return this.send(ut.aftertouch(this._master,t,e)),this};for(var Mt,bt={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},At=0;At<16;At++)bt[At]=At;function It(t){for(var e=[],n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function Ot(t){return t instanceof Array?function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}(t):void 0===t?"":""+t}function Et(t){return(t<16?"0":"")+t.toString(16)}function Bt(t){for(var e=[],n=0;n<t.length;n++)e[n]=Et(t[n]);return e.join(" ")}function Pt(t){return t.length?": "+Bt(It(t)):""}function xt(t){return t.length?": "+function(t){for(var e="",n=0;n<t.length;n++)"\n"==t[n]?e+="\\n":"\r"==t[n]?e+="\\r":"\t"==t[n]?e+="\\t":t.charCodeAt(n)<32?e+="\\x"+Et(t.charCodeAt(n)):e+=t[n];return e}(nt.lib.fromUTF8(t)):""}function Tt(){var t=this instanceof Tt?this:t=new Tt;return t.reset(),arguments.length&&Tt.prototype.setup.apply(t,arguments),t}function Ft(){var t,n;Mt||"undefined"==typeof window||(t=window.AudioContext||window.webkitAudioContext)&&((Mt=new t)&&!Mt.createGain&&(Mt.createGain=Mt.createGainNode),n=function(){if("running"!=Mt.state){Mt.resume();var t=Mt.createOscillator(),e=Mt.createGain();try{e.gain.value=0}catch(t){}e.gain.setTargetAtTime(0,Mt.currentTime,.01),t.connect(e),e.connect(Mt.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else document.removeEventListener("touchend",n),document.removeEventListener("mousedown",n),document.removeEventListener("keydown",n)},document.addEventListener("touchend",n),document.addEventListener("mousedown",n),document.addEventListener("keydown",n),n())}ut.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&this.dd.charCodeAt(0)<16)return this.dd.charCodeAt(0);var t=this[0];return void 0===t||t<128||239<t?void 0:15&t},ut.prototype.setChannel=function(t){return void 0===(t=bt[t])||(32==this.ff?this.dd=String.fromCharCode(t):(void 0!==(e=this[0])&&128<=e||e<=239)&&(this[0]=240&e|t)),this;var e},ut.prototype.getNote=function(){var t=this[0];if(!(void 0===t||t<128||175<t))return this[1]},ut.prototype.setNote=function(t){var e=this[0];return void 0===e||e<128||175<e||void 0!==(t=ut.noteValue(t))&&(this[1]=t),this},ut.prototype.getVelocity=function(){var t=this[0];if(!(void 0===t||t<128||159<t))return this[2]},ut.prototype.setVelocity=function(t){var e=this[0];return void 0===e||e<128||159<e||0<=(t=parseInt(t))&&t<128&&(this[2]=t),this},ut.prototype.getSysExChannel=function(){if(240==this[0])return this[2]},ut.prototype.setSysExChannel=function(t){return 240==this[0]&&2<this.length&&0<=(t=parseInt(t))&&t<128&&(this[2]=t),this},ut.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},ut.prototype.setData=function(t){return this.dd=Ot(t),this},ut.prototype.getText=function(){return nt.lib.fromUTF8(this.dd)},ut.prototype.setText=function(t){return this.dd=nt.lib.toUTF8(t),this},ut.prototype.isNoteOn=function(){var t=this[0];return!(void 0===t||t<144||159<t)&&0<this[2]},ut.prototype.isNoteOff=function(){var t=this[0];return!(void 0===t||t<128||159<t)&&(t<144||0==this[2])},ut.prototype.isSysEx=function(){return 240==this[0]},ut.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},ut.prototype.isSMF=function(){return 0<=this.ff&&this.ff<=127},ut.prototype.toString=function(){if(!this.length){if(void 0===this.ff)return"empty";var t,e="ff"+Et(this.ff)+" -- ";return 0==this.ff?e+="Sequence Number: "+function(t){for(var e=0,n=0;n<t.length;n++)e=(e<<8)+t.charCodeAt(n);return e}(this.dd):0<this.ff&&this.ff<10?e+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+xt(this.dd):32==this.ff?e+="Channel Prefix"+Pt(this.dd):47==this.ff?e+="End of Track"+Pt(this.dd):81==this.ff?(t=65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2),e+="Tempo: "+Math.round(6e9/t)/100+" bpm"):84==this.ff?e+="SMPTE Offset: "+st(It(this.dd)):88==this.ff?(t=1<<this.dd.charCodeAt(1),e+="Time Signature: "+this.dd.charCodeAt(0)+"/"+t,e+=" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3)):89==this.ff?(e+="Key Signature: ",n=this.dd.charCodeAt(0),i=this.dd.charCodeAt(1),128&n&&(n-=256),0<=(n+=7)&&n<=14&&0<=i&&i<=1&&(i&&(n+=3),e+=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][n],i&&(e+=" min"))):127==this.ff?e+="Meta Event"+Pt(this.dd):e+="SMF"+Pt(this.dd),e}if(e=Bt(this),this[0]<128)return e;if(n={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]])return e+" -- "+n;var n,i=this[0]>>4;return(n={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[i])?e+" -- "+n:9==i?e+" -- "+(this[2]?"Note On":"Note Off"):11!=i?e:e+" -- "+(n=(n={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal On/Off",65:"Portamento On/Off",66:"Sostenuto On/Off",67:"Soft Pedal On/Off",68:"Legato Footswitch",69:"Hold 2",70:"Sound Controller 1",71:"Sound Controller 2",72:"Sound Controller 3",73:"Sound Controller 4",74:"Sound Controller 5",75:"Sound Controller 6",76:"Sound Controller 7",77:"Sound Controller 8",78:"Sound Controller 9",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]])||"Undefined")},ut.prototype._stamp=function(t){return this._from.push(t._orig?t._orig:t),this},ut.prototype._unstamp=function(t){return void 0===t?this._from=[]:(t._orig&&(t=t._orig),-1<(t=this._from.indexOf(t))&&this._from.splice(t,1)),this},ut.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var e=0;e<this._from.length;e++)if(this._from[e]==t)return!0;return!1},nt.MIDI=ut,Tt.validate=function(t){t=t instanceof Array?t:arguments;if(t[0]!=parseInt(t[0])||t[0]<0||14<t[0])throw RangeError("Bad master channel value: "+t[0]);if(t[1]!=parseInt(t[1])||t[1]<0||15<t[0]+t[1])throw RangeError("Bad zone size value: "+t[1])},Tt.prototype.reset=function(){for(var t=0;t<16;t++)this[t]={band:0,master:t}},Tt.prototype.setup=function(t,e){var n;Tt.validate(t,e);var i=t+e;if((this[t].master!=t||this[t].band!=e)&&(e||this[t].band)){for(this[t].band?i<(n=t+this[t].band)&&(i=n):this[t].master==t-1?(n=t-1,i<(n+=this[n].band)&&(i=n),this[t-1]={band:0,master:t-1}):this[t].master!=t&&(n=this[t].master,i<(n+=this[n].band)&&(i=n),this[this[t].master].band=t-this[t].master-1),this[t].master=t,this[t].band=e,n=t+1;n<=t+e;n++)this[n].band&&i<n+this[n].band&&(i=n+this[n].band),this[n]={band:0,master:t};for(;n<=i;n++)this[n]={band:0,master:n}}},Tt.prototype.filter=function(t){var e=t.getChannel();if(!this[e]||!this[this[e].master].band)return t;var n,i,r,o=this[e].master,s=this[o].band;if(void 0!==t._mpe){for(r=256,n=o+1;n<=o+s;n++)if(this[n].notes){for(r>this[n].notes.length&&(r=this[e=n].notes.length),i=0;i<this[n].notes.length;i++)if(this[n].notes[i]==t._mpe){e=n,r=-1;break}}else 0<r&&(e=n,r=0);t.setChannel(e),t._mpe=void 0}return e==o||(t.isNoteOn()?(this[e].notes||(this[e].notes=[]),g(this[e].notes,t.getNote())):t.isNoteOff()&&this[e].notes&&v(this[e].notes,t.getNote())),t},nt.MPE=Tt,nt.lib={},nt.lib.now=a,nt.lib.schedule=function(t){setTimeout(t,0)},nt.lib.openMidiOut=function(t,e){var n=new x;return e._openOut(n),n._info=e._info(t),n},nt.lib.openMidiIn=function(t,e){var n=new x;return e._openIn(n),n._info=e._info(t),n},nt.lib.registerMidiOut=function(t,e){for(var n=e._info(t),i=0;i<V._outs.length;i++)if(V._outs[i].name==n.name)return!1;return n.engine=e,V._outs.push(n),S&&S._bad&&(S._repair(),S._resume()),!0},nt.lib.registerMidiIn=function(t,e){for(var n=e._info(t),i=0;i<V._ins.length;i++)if(V._ins[i].name==n.name)return!1;return n.engine=e,V._ins.push(n),S&&S._bad&&(S._repair(),S._resume()),!0},nt.lib.copyMidiHelpers=wt,nt.lib.getAudioContext=function(){return Ft(),Mt};var Dt,qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";nt.lib.fromBase64=function(t){var e,n,i,r,o,s="",u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)e=qt.indexOf(t.charAt(u++))<<2|(i=qt.indexOf(t.charAt(u++)))>>4,n=(15&i)<<4|(r=qt.indexOf(t.charAt(u++)))>>2,i=(3&r)<<6|(o=qt.indexOf(t.charAt(u++))),s+=String.fromCharCode(e),64!=r&&(s+=String.fromCharCode(n)),64!=o&&(s+=String.fromCharCode(i));return s},nt.lib.toBase64=function(t){var e,n,i,r,o=0,s=0,u="",a=[];if(!t)return t;for(;e=(r=t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++))>>18&63,n=r>>12&63,i=r>>6&63,r=63&r,a[s++]=qt.charAt(e)+qt.charAt(n)+qt.charAt(i)+qt.charAt(r),o<t.length;);u=a.join("");var h=t.length%3;return h?u.slice(0,h-3)+"===".slice(h):u},nt.lib.fromUTF8=function(t){t=void 0===t?"":""+t;for(var e,n,i="",r=0;r<t.length;r++){if(255<(e=t.charCodeAt(r)))return t;if(e<128)i+=t[r];else if(192==(224&e)){if(e=(31&e)<<6,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;e+=63&n,i+=String.fromCharCode(e)}else if(224==(240&e)){if(e=(15&e)<<12,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;if(e+=(63&n)<<6,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;e+=63&n,i+=String.fromCharCode(e)}else if(240==(248&e)){if(e=(7&e)<<18,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;if(e+=(63&n)<<12,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;if(e+=(63&n)<<6,++r>=t.length)return t;if(128!=(192&(n=t.charCodeAt(r))))return t;if(1114111<(e+=63&n))return t;e-=65536,i+=String.fromCharCode(55296+(e>>10)),i+=String.fromCharCode(56320+(1023&e))}}return i},nt.lib.toUTF8=function(t){t=void 0===t?"":""+t;for(var e,n="",i=0;i<t.length;i++)(e=t.charCodeAt(i))<128?n+=t[i]:(e<2048?n+=String.fromCharCode(192+(e>>6)):(e<65536?n+=String.fromCharCode(224+(e>>12)):(n+=String.fromCharCode(240+(e>>18)),n+=String.fromCharCode(128+(e>>12&63))),n+=String.fromCharCode(128+(e>>6&63))),n+=String.fromCharCode(128+(63&e)));return n};var kt,Lt=[],zt={},Nt={},jt={},Rt={};function Wt(){}var Ut=n.Promise;"function"!=typeof Ut&&((Ut=function(t){this.executor=t}).prototype.then=function(t,e){"function"!=typeof t&&(t=function(){}),"function"!=typeof e&&(e=function(){}),this.executor(t,e)});var Gt=n.Map;function Vt(){for(var t=new Array(64),e=0;e<64;e++)t[e]=Math.floor(16*Math.random()%16).toString(16).toUpperCase();return t.join("")}function Jt(t,e){return e?(Nt[t]||(Nt[t]=Vt()),Nt[t]):(zt[t]||(zt[t]=Vt()),zt[t])}function Zt(){this.sysexEnabled=!0,this.outputs=new Gt,this.inputs=new Gt;var r=this;function o(t){return function(){kt(new Ht(t,r))}}function e(t){for(var e,n,i=0;i<t.inputs.added.length;i++)e=new $t(t.inputs.added[i]),r.inputs.set(e.id,e),n=o(e),e.open().then(n,n);for(i=0;i<t.outputs.added.length;i++)e=new Kt(t.outputs.added[i]),r.outputs.set(e.id,e),n=o(e),e.open().then(n,n);for(i=0;i<t.inputs.removed.length;i++)(e=r.inputs.get(Nt[t.inputs.removed[i].name])).close(),r.inputs.delete(e.id),kt(new Ht(e,r));for(i=0;i<t.outputs.removed.length;i++)(e=r.outputs.get(zt[t.outputs.removed[i].name])).close(),r.outputs.delete(e.id),kt(new Ht(e,r))}Object.defineProperty(this,"onstatechange",{get:function(){return kt},set:function(t){t instanceof Function?(kt||nt().onChange(e),kt=t):kt&&(nt().onChange().disconnect(e),kt=void 0)}})}function Ht(t,e){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=t,this.returnValue=!0,this.srcElement=e,this.target=e,this.timeStamp=a(),this.type="statechange"}function Qt(t,e){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.data=e,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=a(),this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=this.receivedTime,this.type="midimessage"}function Kt(t){var e=this;this.type="output",this.name=t.name,this.manufacturer=t.manufacturer,this.version=t.version,this.id=Jt(this.name,!1),this.state="disconnected",this.connection="closed",Object.defineProperty(this,"onstatechange",{get:function(){return jt[e.name].onstatechange},set:function(t){Function,jt[e.name].onstatechange=t}})}function $t(t){var e=this;this.type="input",this.name=t.name,this.manufacturer=t.manufacturer,this.version=t.version,this.id=Jt(this.name,!0),this.state="disconnected",this.connection="closed",Object.defineProperty(this,"onstatechange",{get:function(){return Rt[e.name].onstatechange},set:function(t){Function,Rt[e.name].onstatechange=t}})}return"function"!=typeof Gt&&((Gt=function(){this.store={},this.keys=[]}).prototype.set=function(t,e){return void 0===this.store[t]&&this.keys.push(t),this.store[t]=e,this.size=this.keys.length,this},Gt.prototype.get=function(t){return this.store[t]},Gt.prototype.delete=function(t){delete this.store[t];t=this.keys.indexOf(t);return-1<t&&this.keys.splice(t,1),this.size=this.keys.length,this},Gt.prototype.forEach=function(t){for(var e=this.keys.length,n=0;n<e;n++)t(this.store[this.keys[n]])}),Zt.prototype.onstatechange=function(){},Kt.prototype.open=function(){var n=this;return new Ut(function(e,t){jt[n.name]?e(n):(n._resolves||(n._resolves=[]),n._resolves.push(e),1==n._resolves.length&&nt().openMidiOut(n.name).or(t).and(function(){jt[n.name]=this,n.state="connected",n.connection="open";for(var t=0;t<n._resolves.length;t++)e(n._resolves[t]);delete n._resolves,n.onstatechange&&n.onstatechange(new Ht(n,n))}))})},Kt.prototype.close=function(){var t=jt[this.name];return t&&(t.close(),this.state="disconnected",this.connection="closed",this.onstatechange&&this.onstatechange(new Ht(this,this)),jt[this.name]=void 0),this},Kt.prototype.clear=function(){},Kt.prototype.send=function(t,e){var n=jt[this.name];if(n){for(var i=[],r=0;r<t.length;r++){if(!(t[r]==Math.floor(t[r])&&0<=t[r]&&t[r]<=255))return;i.push(t[r])}e>a()?setTimeout(function(){n.send(i)},e-a()):n.send(i)}else{var o=this;o.open().then(function(){o.send(t,e)},Wt)}},$t.prototype.onmidimessage=function(){},$t.prototype.open=function(){var n=this;return new Ut(function(e,t){Rt[n.name]?e(n):(n._resolves||(n._resolves=[]),n._resolves.push(e),1==n._resolves.length&&nt().openMidiIn(n.name).or(t).and(function(){Rt[n.name]=this,n.state="connected",n.connection="open",this.connect(function(t){n.onmidimessage(new Qt(n,new Uint8Array(t)))});for(var t=0;t<n._resolves.length;t++)e(n._resolves[t]);delete n._resolves,n.onstatechange&&n.onstatechange(new Ht(n,n))}))})},$t.prototype.close=function(){var t=Rt[this.name];return t&&(t.close(),this.state="disconnected",this.connection="closed",this.onstatechange&&this.onstatechange(new Ht(this,this)),Rt[this.name]=void 0),this.onmidimessage=$t.prototype.onmidimessage,this},nt.requestMIDIAccess=function(){var i,r;function o(){Dt=i;for(var t=0;t<Lt.length;t++)Lt[t](Dt)}function s(){--r||o()}return new Ut(function(t,e){Dt?t(Dt):(Lt.push(t),1==Lt.length&&(i=new Zt,nt().or(o).and(function(){var t=this.info();if(r=t.inputs.length+t.outputs.length){for(var e,n=0;n<t.outputs.length;n++)e=new Kt(t.outputs[n]),i.outputs.set(e.id,e),e.open().then(s,s);for(n=0;n<t.inputs.length;n++)e=new $t(t.inputs[n]),i.inputs.set(e.id,e),e.open().then(s,s)}else o()})))})},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=nt.requestMIDIAccess),nt.close=function(){G._close&&G._close()},nt});