!function(a,b){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define("JZZ",[],b);else{if(a.JZZ&&a.JZZ.MIDI)return;a.JZZ=b()}}(this,function(){function a(){this._orig=this,this._ready=!1,this._queue=[],this._err=[]}function b(a,b){setTimeout(function(){a._resume()},b)}function c(a){a._resume()}function d(a,b,d){a[d]=function(){var a=arguments,e=b._image();return this._push(c,[e]),e[d].apply(e,a)}}function e(a){a instanceof Function?a.apply(this):console.log(a)}function f(a){a instanceof Function?a.apply(this):console.log(a)}function g(a){this._break("closed"),a._resume()}function h(a){if(!a.length)return void this._break();var b=a.shift();if(a.length){var c=this;this._slip(f,[function(){h.apply(c,[a])}])}try{this._repair(),b.apply(this)}catch(d){this._break(d.toString())}}function i(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return;a.push(b)}function j(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return void a.splice(c,1)}function k(){a.apply(this)}function l(){k.prototype._time||(k.prototype._time=function(){return Date.now()}),k.prototype._startTime=k.prototype._time(),k.prototype.time=function(){return k.prototype._time()-k.prototype._startTime}}function m(a,b,c){if("undefined"==typeof b)return m(a,[],[]);if(a instanceof Object){for(var d=0;d<b.length;d++)if(b[d]===a)return c[d];var e;e=a instanceof Array?[]:{},b.push(a),c.push(e);for(var f in a)a.hasOwnProperty(f)&&(e[f]=m(a[f],b,c));return e}return a}function n(){this._orig._info.engine=Ha._type,this._orig._info.version=Ha._version,this._orig._info.sysex=Ha._sysex,this._orig._info.inputs=[],this._orig._info.outputs=[],Ea=[],Fa=[],Ha._allOuts={},Ha._allIns={};var a,b;for(a=0;a<Ha._outs.length;a++)b=Ha._outs[a],b.engine=Ha,Ha._allOuts[b.name]=b,this._orig._info.outputs.push({name:b.name,manufacturer:b.manufacturer,version:b.version,engine:Ha._type}),Ea.push(b);for(a=0;a<Ia._outs.length;a++)b=Ia._outs[a],this._orig._info.outputs.push({name:b.name,manufacturer:b.manufacturer,version:b.version,engine:b.type}),Ea.push(b);for(a=0;a<Ha._ins.length;a++)b=Ha._ins[a],b.engine=Ha,Ha._allIns[b.name]=b,this._orig._info.inputs.push({name:b.name,manufacturer:b.manufacturer,version:b.version,engine:Ha._type}),Fa.push(b);for(a=0;a<Ia._ins.length;a++)b=Ia._ins[a],this._orig._info.inputs.push({name:b.name,manufacturer:b.manufacturer,version:b.version,engine:b.type}),Fa.push(b)}function o(){this._slip(n,[]),Ha._refresh(this)}function p(a,b){if("undefined"==typeof a)return b.slice();var c,d,e=[];if(a instanceof RegExp){for(d=0;d<b.length;d++)a.test(b[d].name)&&e.push(b[d]);return e}for(a instanceof Function&&(a=a(b)),a instanceof Array||(a=[a]),c=0;c<a.length;c++)for(d=0;d<b.length;d++)(a[c]+""==d+""||a[c]===b[d].name||a[c]instanceof Object&&a[c].name===b[d].name)&&e.push(b[d]);return e}function q(a,b){var c;c=b instanceof RegExp?"Port matching "+b+" not found":b instanceof Object||"undefined"==typeof b?"Port not found":'Port "'+b+'" not found',a._crash(c)}function r(a,b){var c=p(b,Ea);if(!c.length)return void q(a,b);for(var d=function(a){return function(){a.engine._openOut(this,a.name)}},e=0;e<c.length;e++)c[e]=d(c[e]);a._slip(h,[c]),a._resume()}function s(a,b){var c=p(b,Fa);if(!c.length)return void q(a,b);for(var d=function(a){return function(){a.engine._openIn(this,a.name)}},e=0;e<c.length;e++)c[e]=d(c[e]);a._slip(h,[c]),a._resume()}function t(a,b){a._slip(D,[b]),a._resume()}function u(){a.apply(this),this._handles=[],this._outs=[]}function v(a){this._receive(a)}function w(a){this._emit(a)}function x(a){a instanceof Function?i(this._orig._handles,a):i(this._orig._outs,a)}function y(a){"undefined"==typeof a?(this._orig._handles=[],this._orig._outs=[]):a instanceof Function?j(this._orig._handles,a):j(this._orig._outs,a)}function z(a,b){this._orig._mpe||(this._orig._mpe=new ka),this._orig._mpe.setup(a,b)}function A(a,b){u.apply(this),this._port=a._orig,this._chan=b,d(this,this._port,"ch"),d(this,this._port,"mpe"),d(this,this._port,"connect"),d(this,this._port,"disconnect"),d(this,this._port,"close")}function B(a,b,c){u.apply(this),this._port=a._orig,this._master=b,this._band=c,d(this,this._port,"ch"),d(this,this._port,"mpe"),d(this,this._port,"connect"),d(this,this._port,"disconnect"),d(this,this._port,"close")}function C(){a.apply(this),this._handles=[],d(this,Ga,"refresh"),d(this,Ga,"openMidiOut"),d(this,Ga,"openMidiIn"),d(this,Ga,"onChange"),d(this,Ga,"close")}function D(a){a instanceof Function&&(this._orig._handles.length||Ha._watch(),i(this._orig._handles,a))}function E(a){"undefined"==typeof a?this._orig._handles=[]:j(this._orig._handles,a),this._orig._handles.length||Ha._unwatch()}function F(a,b,c,d){var e;if(a.length!=c.length||b.length!=d.length)return!0;for(e=0;e<a.length;e++)if(a[e].name!=c[e].name)return!0;for(e=0;e<b.length;e++)if(b[e].name!=d[e].name)return!0;return!1}function G(a,b,c,d){if(F(a,b,c,d)){var e,f=[],g=[],h=[],i=[],j={};for(e=0;e<a.length;e++)j[a[e].name]=!0;for(e=0;e<c.length;e++)j[c[e].name]||f.push(c[e]);for(j={},e=0;e<c.length;e++)j[c[e].name]=!0;for(e=0;e<a.length;e++)j[a[e].name]||h.push(a[e]);for(j={},e=0;e<b.length;e++)j[b[e].name]=!0;for(e=0;e<d.length;e++)j[d[e].name]||g.push(d[e]);for(j={},e=0;e<d.length;e++)j[d[e].name]=!0;for(e=0;e<b.length;e++)j[b[e].name]||i.push(b[e]);return f.length||h.length||g.length||i.length?{inputs:{added:f,removed:h},outputs:{added:g,removed:i}}:void 0}}function H(a){for(ua=0;ua<Ga._watcher._handles.length;ua++)Ga._watcher._handles[ua].apply(Ga,[a])}function I(){return"undefined"!=typeof module&&module.exports?void T(require("jazz-midi")):void this._break()}function J(){var a=document.createElement("div");a.style.visibility="hidden",document.body.appendChild(a);var b=document.createElement("object");return b.style.visibility="hidden",b.style.width="0px",b.style.height="0px",b.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",b.type="audio/x-jazz",document.body.appendChild(b),b.isJazz?void U(b):void this._break()}function K(){if(navigator.requestMIDIAccess){var a=this,b=function(b){V(b),a._resume()},c=function(b){a._crash(b)},d={};return navigator.requestMIDIAccess(d).then(b,c),void this._pause()}this._break()}function L(){if(navigator.requestMIDIAccess){var a=this,b=function(b){V(b,!0),a._resume()},c=function(b){a._crash(b)},d={sysex:!0};return navigator.requestMIDIAccess(d).then(b,c),void this._pause()}this._break()}function M(){function a(e){if(b=!0,c||(c=document.getElementById("jazz-midi-msg")),c){var f=[];try{f=JSON.parse(c.innerText)}catch(g){}c.innerText="",document.removeEventListener("jazz-midi-msg",a),"version"===f[0]?(W(c,f[2]),d._resume()):d._crash()}}var b,c,d=this;this._pause(),document.addEventListener("jazz-midi-msg",a);try{document.dispatchEvent(new Event("jazz-midi"))}catch(e){}window.setTimeout(function(){b||d._crash()},0)}function N(){this._pause();var a=this;setTimeout(function(){a._crash()},0)}function O(a){for(var b=[I,N],c=P(a),d=0;d<c.length;d++)"webmidi"==c[d]?(a&&a.sysex===!0&&b.push(L),a&&a.sysex===!0&&a.degrade!==!0||b.push(K)):"extension"==c[d]?b.push(M):"plugin"==c[d]&&b.push(J);return b.push(R),b}function P(a){var b=["extension","plugin","webmidi"];if(!a||!a.engine)return b;var c,d,e,f=a.engine instanceof Array?a.engine:[a.engine],g={},h=[],i=[];for(e=0;e<f.length;e++){var k=f[e].toString().toLowerCase();g[k]||(g[k]=!0,"none"===k&&(c=!0),"etc"===k&&(d=!0),d?i.push(k):h.push(k),j(b,k))}return(d||h.length||i.length)&&(c=!1),c?[]:h.concat(d?b:i)}function Q(a){la(),Ga=new k,Ga._options=a,Ga._push(h,[O(a)]),Ga.refresh(),Ga._push(l,[]),Ga._push(function(){Ea.length||Fa.length||this._break()},[]),Ga._resume()}function R(){Ha._type="none",Ha._sysex=!0,Ha._refresh=function(){Ha._outs=[],Ha._ins=[]},Ha._watch=function(){},Ha._unwatch=function(){}}function S(){function a(){c&&(Ha._refresh(),c=!1)}function b(b){c=!0,setTimeout(a,0)}Ha._inArr=[],Ha._outArr=[],Ha._inMap={},Ha._outMap={},Ha._outsW=[],Ha._insW=[],Ha._version=Ha._main.version,Ha._sysex=!0;var c;_closeAll=function(){for(var a=0;a<this.clients.length;a++)this._close(this.clients[a])},Ha._refresh=function(){Ha._outs=[],Ha._ins=[];var a,b;for(a=0;(b=Ha._main.MidiOutInfo(a)).length;a++)Ha._outs.push({type:Ha._type,name:b[0],manufacturer:b[1],version:b[2]});for(a=0;(b=Ha._main.MidiInInfo(a)).length;a++)Ha._ins.push({type:Ha._type,name:b[0],manufacturer:b[1],version:b[2]});var d=G(Ha._insW,Ha._outsW,Ha._ins,Ha._outs);if(d){for(va=0;va<d.inputs.removed.length;va++)impl=Ha._inMap[d.inputs.removed[va].name],impl&&impl._closeAll();for(va=0;va<d.outputs.removed.length;va++)impl=Ha._outMap[d.inputs.removed[va].name],impl&&impl._closeAll();Ha._insW=Ha._ins,Ha._outsW=Ha._outs,c&&H(d)}},Ha._openOut=function(a,b){var c=Ha._outMap[b];if(!c){Ha._pool.length<=Ha._outArr.length&&Ha._pool.push(Ha._newPlugin()),c={name:b,clients:[],info:{name:b,manufacturer:Ha._allOuts[b].manufacturer,version:Ha._allOuts[b].version,type:"MIDI-out",sysex:Ha._sysex,engine:Ha._type},_close:function(a){Ha._closeOut(a)},_closeAll:_closeAll,_receive:function(a){this.plugin.MidiOutRaw(a.slice())}};var d=Ha._pool[Ha._outArr.length];c.plugin=d,Ha._outArr.push(c),Ha._outMap[b]=c}if(!c.open){var e=c.plugin.MidiOutOpen(b);if(e!==b)return e&&c.plugin.MidiOutClose(),void a._break();c.open=!0}a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._receive=function(a){c._receive(a)},a._close=function(){c._close(this)}},Ha._openIn=function(a,b){var c=Ha._inMap[b];if(!c){Ha._pool.length<=Ha._inArr.length&&Ha._pool.push(Ha._newPlugin()),c={name:b,clients:[],info:{name:b,manufacturer:Ha._allIns[b].manufacturer,version:Ha._allIns[b].version,type:"MIDI-in",sysex:Ha._sysex,engine:Ha._type},_close:function(a){Ha._closeIn(a)},_closeAll:_closeAll,handle:function(a,b){for(var c=0;c<this.clients.length;c++){var d=ba(b);this.clients[c]._emit(d)}}};var d=function(a){return function(b,c){a.handle(b,c)}};c.onmidi=d(c);var e=Ha._pool[Ha._inArr.length];c.plugin=e,Ha._inArr.push(c),Ha._inMap[b]=c}if(!c.open){var f=c.plugin.MidiInOpen(b,c.onmidi);if(f!==b)return f&&c.plugin.MidiInClose(),void a._break();c.open=!0}a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._close=function(){c._close(this)}},Ha._closeOut=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.open=!1,b.plugin.MidiOutClose())},Ha._closeIn=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.open=!1,b.plugin.MidiInClose())},Ha._close=function(){for(var a=0;a<Ha._inArr.length;a++)Ha._inArr[a].open&&Ha._inArr[a].plugin.MidiInClose();Ha._unwatch()},Ha._watch=function(){Ha._main.OnConnectMidiIn(b),Ha._main.OnConnectMidiOut(b),Ha._main.OnDisconnectMidiIn(b),Ha._main.OnDisconnectMidiOut(b)},Ha._unwatch=function(){Ha._main.OnConnectMidiIn(),Ha._main.OnConnectMidiOut(),Ha._main.OnDisconnectMidiIn(),Ha._main.OnDisconnectMidiOut()},k.prototype._time=function(){return Ha._main.Time()}}function T(a){Ha._type="node",Ha._main=a,Ha._pool=[],Ha._newPlugin=function(){return new a.MIDI},S()}function U(a){Ha._type="plugin",Ha._main=a,Ha._pool=[a],Ha._newPlugin=function(){var b=document.createElement("object");return b.style.visibility="hidden",b.style.width="0px",a.style.height="0px",b.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",b.type="audio/x-jazz",document.body.appendChild(b),b.isJazz?b:void 0},S()}function V(a,b){Ha._type="webmidi",Ha._version=43,Ha._sysex=!!b,Ha._access=a,Ha._inMap={},Ha._outMap={},Ha._outsW=[],Ha._insW=[];var c;_closeAll=function(){for(var a=0;a<this.clients.length;a++)this._close(this.clients[a])},Ha._refresh=function(){Ha._outs=[],Ha._ins=[],Ha._access.outputs.forEach(function(a,b){Ha._outs.push({type:Ha._type,name:a.name,manufacturer:a.manufacturer,version:a.version})}),Ha._access.inputs.forEach(function(a,b){Ha._ins.push({type:Ha._type,name:a.name,manufacturer:a.manufacturer,version:a.version})});var a=G(Ha._insW,Ha._outsW,Ha._ins,Ha._outs);if(a){for(va=0;va<a.inputs.removed.length;va++)impl=Ha._inMap[a.inputs.removed[va].name],impl&&impl._closeAll();for(va=0;va<a.outputs.removed.length;va++)impl=Ha._outMap[a.inputs.removed[va].name],impl&&impl._closeAll();Ha._insW=Ha._ins,Ha._outsW=Ha._outs,c&&H(a)}},Ha._openOut=function(a,b){var c=Ha._outMap[b];c||(c={name:b,clients:[],info:{name:b,manufacturer:Ha._allOuts[b].manufacturer,version:Ha._allOuts[b].version,type:"MIDI-out",sysex:Ha._sysex,engine:Ha._type},_close:function(a){Ha._closeOut(a)},_closeAll:_closeAll,_receive:function(a){c.dev&&this.dev.send(a.slice())}});var d;Ha._access.outputs.forEach(function(a,c){a.name===b&&(d=a)}),d?(c.dev=d,Ha._outMap[b]=c,c.dev.open&&c.dev.open(),a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._receive=function(a){c._receive(a)},a._close=function(){c._close(this)}):a._break()},Ha._openIn=function(a,b){var c=Ha._inMap[b];c||(c={name:b,clients:[],info:{name:b,manufacturer:Ha._allIns[b].manufacturer,version:Ha._allIns[b].version,type:"MIDI-in",sysex:Ha._sysex,engine:Ha._type},_close:function(a){Ha._closeIn(a)},_closeAll:_closeAll,handle:function(a){for(var b=0;b<this.clients.length;b++){var c=ba([].slice.call(a.data));this.clients[b]._emit(c)}}});var d;if(Ha._access.inputs.forEach(function(a,c){a.name===b&&(d=a)}),d){c.dev=d;var e=function(a){return function(b){a.handle(b)}};c.dev.onmidimessage=e(c),Ha._inMap[b]=c,c.dev.open&&c.dev.open(),a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._close=function(){c._close(this)}}else a._break()},Ha._closeOut=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.dev&&b.dev.close&&b.dev.close(),b.dev=void 0)},Ha._closeIn=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.dev&&b.dev.close&&b.dev.close(),b.dev=void 0)},Ha._close=function(){},Ha._watch=function(){Ha._access.onstatechange=function(){c=!0,setTimeout(function(){c&&(Ha._refresh(),c=!1)},0)}},Ha._unwatch=function(){Ha._access.onstatechange=void 0}}function W(a,b){Ha._type="extension",Ha._version=b,Ha._sysex=!0,Ha._pool=[],Ha._outs=[],Ha._ins=[],Ha._inArr=[],Ha._outArr=[],Ha._inMap={},Ha._outMap={},Ha._outsW=[],Ha._insW=[],Ha.refreshClients=[],Ha._msg=a,Ha._newPlugin=function(){var a={id:Ha._pool.length};a.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):a.ready=!0,Ha._pool.push(a)},Ha._newPlugin(),Ha._refresh=function(a){Ha.refreshClients.push(a),a._pause(),setTimeout(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},0)},_closeAll=function(){for(var a=0;a<this.clients.length;a++)this._close(this.clients[a])},Ha._openOut=function(a,b){var c=Ha._outMap[b];if(!c){Ha._pool.length<=Ha._outArr.length&&Ha._newPlugin();var d=Ha._pool[Ha._outArr.length];c={name:b,clients:[],info:{name:b,manufacturer:Ha._allOuts[b].manufacturer,version:Ha._allOuts[b].version,type:"MIDI-out",sysex:Ha._sysex,engine:Ha._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",d.id,b]}))},_close:function(a){Ha._closeOut(a)},_closeAll:_closeAll,_receive:function(a){var b=a.slice();b.splice(0,0,"play",d.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:b}))}},c.plugin=d,d.output=c,Ha._outArr.push(c),Ha._outMap[b]=c}a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._receive=function(a){c._receive(a)},a._close=function(){c._close(this)},c.open||(c.plugin.ready&&c._start(),a._pause())},Ha._openIn=function(a,b){var c=Ha._inMap[b];if(!c){Ha._pool.length<=Ha._inArr.length&&Ha._newPlugin();var d=Ha._pool[Ha._inArr.length];c={name:b,clients:[],info:{name:b,manufacturer:Ha._allIns[b].manufacturer,version:Ha._allIns[b].version,type:"MIDI-in",sysex:Ha._sysex,engine:Ha._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",d.id,b]}))},_close:function(a){Ha._closeIn(a)},_closeAll:_closeAll},c.plugin=d,d.input=c,Ha._inArr.push(c),Ha._inMap[b]=c}a._orig._impl=c,i(c.clients,a._orig),a._info=c.info,a._close=function(){c._close(this)},c.open||(c.plugin.ready&&c._start(),a._pause())},Ha._closeOut=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",b.plugin.id]})))},Ha._closeIn=function(a){var b=a._impl;j(b.clients,a._orig),b.clients.length||(b.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",b.plugin.id]})))},Ha._close=function(){};var c;Ha._watch=function(){Ha._insW=Ha._ins,Ha._outsW=Ha._outs,c=setInterval(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},250)},Ha._unwatch=function(){clearInterval(c),c=void 0},document.addEventListener("jazz-midi-msg",function(a){var b,d,e,f=Ha._msg.innerText.split("\n");for(Ha._msg.innerText="",d=0;d<f.length;d++){var g=[];try{g=JSON.parse(f[d])}catch(h){}if(g.length)if("refresh"===g[0]){if(g[1].ins){for(e=0;e<g[1].ins.length;e++)g[1].ins[e].type=Ha._type;Ha._ins=g[1].ins}if(g[1].outs){for(e=0;e<g[1].outs.length;e++)g[1].outs[e].type=Ha._type;Ha._outs=g[1].outs}for(e=0;e<Ha.refreshClients.length;e++)Ha.refreshClients[e]._resume();Ha.refreshClients=[];var i=G(Ha._insW,Ha._outsW,Ha._ins,Ha._outs);if(i){for(Ha._insW=Ha._ins,Ha._outsW=Ha._outs,e=0;e<i.inputs.removed.length;e++)b=Ha._inMap[i.inputs.removed[e].name],b&&b._closeAll();for(e=0;e<i.outputs.removed.length;e++)b=Ha._outMap[i.outputs.removed[e].name],b&&b._closeAll();c&&H(i)}}else if("version"===g[0]){var j=Ha._pool[g[1]];j&&(j.ready=!0,j.input&&j.input._start(),j.output&&j.output._start())}else if("openout"===g[0]){if(b=Ha._pool[g[1]].output)if(g[2]==b.name){if(b.open=!0,b.clients)for(e=0;e<b.clients.length;e++)b.clients[e]._resume()}else if(b.clients)for(e=0;e<b.clients.length;e++)b.clients[e]._crash()}else if("openin"===g[0]){if(b=Ha._pool[g[1]].input)if(g[2]==b.name){if(b.open=!0,b.clients)for(e=0;e<b.clients.length;e++)b.clients[e]._resume()}else if(b.clients)for(e=0;e<b.clients.length;e++)b.clients[e]._crash()}else if("midi"===g[0]&&(b=Ha._pool[g[1]].input,b&&b.clients))for(e=0;e<b.clients.length;e++){var k=ba(g.slice(3));b.clients[e]._emit(k)}}})}function X(){var a=this instanceof X?this:a=new X;return X.prototype.reset.apply(a,arguments),a}function Y(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function Z(a){return[[24,25,29.97,30][a[7]>>1&3],(1&a[7])<<4|a[6],a[5]<<4|a[4],a[3]<<4|a[2],a[1]<<4|a[0]]}function $(a){!a.backwards&&a.quarter>=4?a.decrFrame():a.backwards&&a.quarter<4&&a.incrFrame();var b;switch(a.quarter>>1){case 0:b=a.frame;break;case 1:b=a.second;break;case 2:b=a.minute;break;default:b=a.hour}return 1&a.quarter?b>>=4:b&=15,7==a.quarter&&(25==a.type?b|=2:29.97==a.type?b|=4:30==a.type&&(b|=6)),!a.backwards&&a.quarter>=4?a.incrFrame():a.backwards&&a.quarter<4&&a.decrFrame(),b|a.quarter<<4}function _(a){return 25==a.type?32|a.hour:29.97==a.type?64|a.hour:30==a.type?96|a.hour:a.hour}function aa(a){return 10>a?"0"+a:a}function ba(a){var b=this instanceof ba?this:b=new ba;if(a instanceof ba?(b._from=a._from.slice(),b._mpe=a._mpe):b._from=[],!arguments.length)return b;var c=a instanceof Array?a:arguments;for(ua=0;ua<c.length;ua++)ya=c[ua],1==ua&&(b[0]>=128&&b[0]<=175&&(ya=ba.noteValue(ya)),b[0]>=192&&b[0]<=207&&(ya=ba.programValue(ya))),(ya!=parseInt(ya)||0>ya||ya>255)&&ca(c[ua]),b.push(ya);return b}function ca(a){throw RangeError("Bad MIDI value: "+a)}function da(a){return(a!=parseInt(a)||0>a||a>15)&&ca(a),a}function ea(a,b){return(a!=parseInt(a)||0>a||a>127)&&ca("undefined"==typeof b?a:b),a}function fa(a){return(a!=parseInt(a)||0>a||a>16383)&&ca(a),127&a}function ga(a){return(a!=parseInt(a)||0>a||a>16383)&&ca(a),a>>7}function ha(a,b){ba[a]=function(){return new ba(b.apply(0,arguments))},u.prototype[a]=function(){return this.send(b.apply(0,arguments)),this}}function ia(a,b){ha(a,b),A.prototype[a]=function(){return this.send(b.apply(0,[this._chan].concat(Array.prototype.slice.call(arguments)))),this},B.prototype[a]=function(){var a,c=Array.prototype.slice.call(arguments);c.length<b.length?c=[this._master].concat(c):(a=ea(ba.noteValue(c[0],c[0])),c[0]=this._master);var d=b.apply(0,c);return d.mpe=a,this.send(d),this}}function ja(a){for(var b=[],c=0;c<a.length;c++)b[c]=(a[c]<16?"0":"")+a[c].toString(16);return b.join(" ")}function ka(){var a=this instanceof ka?this:a=new ka;return a.reset(),arguments.length&&ka.prototype.setup.apply(a,arguments),a}function la(){if(!Pa&&"undefined"!=typeof window){var a=window.AudioContext||window.webkitAudioContext;if(a){Pa=new a,Pa&&!Pa.createGain&&(Pa.createGain=Pa.createGainNode);var b=function(){if("running"!=Pa.state){Pa.resume();var a=Pa.createOscillator(),c=Pa.createGain();try{c.gain.value=0}catch(d){}c.gain.setTargetAtTime(0,Pa.currentTime,.01),a.connect(c),c.connect(Pa.destination),a.start||(a.start=a.noteOn),a.stop||(a.stop=a.noteOff),a.start(.1),a.stop(.11)}else document.removeEventListener("touchend",b),document.removeEventListener("mousedown",b),document.removeEventListener("keydown",b)};document.addEventListener("touchend",b),document.addEventListener("mousedown",b),document.addEventListener("keydown",b),b()}}}function ma(){}function na(){for(var a=new Array(64),b=0;64>b;b++)a[b]=Math.floor(16*Math.random()%16).toString(16).toUpperCase();return a.join("")}function oa(a,b){return b?(Ua[a]||(Ua[a]=na()),Ua[a]):(Ta[a]||(Ta[a]=na()),Ta[a])}function pa(){this.sysexEnabled=!0,this.outputs=new Ya,this.inputs=new Ya,Object.defineProperty(this,"onstatechange",{get:function(){return Ra},set:function(a){a instanceof Function?Ra=a:Ra&&(Ra=void 0)}})}function qa(a,b){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=b,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=a,this.returnValue=!0,this.srcElement=b,this.target=b,this.timeStamp=Da(),this.type="statechange"}function ra(a,b){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=a,this.data=b,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=Da(),this.returnValue=!0,this.srcElement=a,this.target=a,this.timeStamp=this.receivedTime,this.type="midimessage"}function sa(a){var b=this;this.type="output",this.name=a.name,this.manufacturer=a.manufacturer,this.version=a.version,this.id=oa(this.name,!1),this.state="disconnected",this.connection="closed",Object.defineProperty(this,"onstatechange",{get:function(){return outputMap[b.name].onstatechange},set:function(a){a instanceof Function?(outputMap[b.name].onstatechange=a,outputMap[b.name].onstatechange(new qa(b,b))):outputMap[b.name].onstatechange=a}})}function ta(a){var b=this;this.type="input",this.name=a.name,this.manufacturer=a.manufacturer,this.version=a.version,this.id=oa(this.name,!0),this.state="disconnected",this.connection="closed",Object.defineProperty(this,"onstatechange",{get:function(){return inputMap[b.name].onstatechange},set:function(a){a instanceof Function?(inputMap[b.name].onstatechange=a,inputMap[b.name].onstatechange(new qa(b,b))):inputMap[b.name].onstatechange=a}})}var ua,va,wa,xa,ya,za="undefined"==typeof window?global:window,Aa="0.4.5",Ba=Date.now||function(){return(new Date).getTime()},Ca=Ba(),Da="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Ba()-Ca};a.prototype._exec=function(){for(;this._ready&&this._queue.length;){var a=this._queue.shift();this._orig._bad?this._orig._hope&&a[0]==f?(this._orig._hope=!1,a[0].apply(this,a[1])):(this._queue=[],this._orig._hope=!1):a[0]!=f&&a[0].apply(this,a[1])}},a.prototype._push=function(b,c){this._queue.push([b,c]),a.prototype._exec.apply(this)},a.prototype._slip=function(a,b){this._queue.unshift([a,b])},a.prototype._pause=function(){this._ready=!1},a.prototype._resume=function(){this._ready=!0,a.prototype._exec.apply(this)},a.prototype._break=function(a){this._orig._bad=!0,this._orig._hope=!0,a&&this._orig._err.push(a)},a.prototype._repair=function(){this._orig._bad=!1},a.prototype._crash=function(a){this._break(a),this._resume()},a.prototype.err=function(){return m(this._err)},a.prototype._image=function(){var a=function(){};a.prototype=this._orig;var b=new a;return b._ready=!1,b._queue=[],b},a.prototype.wait=function(a){if(!a)return this;var c=this._image();return this._push(b,[c,a]),c},a.prototype.and=function(a){return this._push(e,[a]),this},a.prototype.or=function(a){return this._push(f,[a]),this},a.prototype._info={},a.prototype.info=function(){var a=m(this._orig._info);return"undefined"==typeof a.engine&&(a.engine="none"),"undefined"==typeof a.sysex&&(a.sysex=!0),a},a.prototype.name=function(){return this.info().name},a.prototype.close=function(){var b=new a;return this._close&&this._push(this._close,[]),this._push(g,[b]),b},k.prototype=new a,k.prototype.time=function(){return 0},"undefined"!=typeof performance&&performance.now&&(k.prototype._time=function(){return performance.now()}),k.prototype._info={name:"JZZ.js",ver:Aa,version:Aa};var Ea=[],Fa=[];k.prototype.refresh=function(){return this._push(o,[]),this},k.prototype.openMidiOut=function(a){var b=new u;return this._push(o,[]),this._push(r,[b,a]),b},k.prototype.openMidiIn=function(a){var b=new u;return this._push(o,[]),this._push(s,[b,a]),b},k.prototype.onChange=function(a){this._orig._watcher||(this._orig._watcher=new C);var b=this._orig._watcher._image();return this._push(t,[b,a]),b},k.prototype._close=function(){Ha._close()},u.prototype=new a,u.prototype._filter=function(a){if(this._orig._mpe){var b,c=0;this._handles&&this._handles.length&&(c=this._handles.length,b=this._handles[0]),this._outs&&this._outs.length&&(c=this._outs.length,b=this._outs[0]),1!=c||b._mpe||(a=this._orig._mpe.filter(a))}return a},u.prototype._receive=function(a){this._emit(this._filter(a))},u.prototype.send=function(){return this._push(v,[ba.apply(null,arguments)]),this},u.prototype.note=function(a,b,c,d){return this.noteOn(a,b,c),d&&this.wait(d).noteOff(a,b),this},u.prototype._emit=function(a){var b;for(b=0;b<this._handles.length;b++)this._handles[b].apply(this,[ba(a)._stamp(this)]);for(b=0;b<this._outs.length;b++){var c=ba(a);c._stamped(this._outs[b])||this._outs[b].send(c._stamp(this))}},u.prototype.emit=function(a){return this._push(w,[a]),this},u.prototype.connect=function(a){return this._push(x,[a]),this},u.prototype.disconnect=function(a){return this._push(y,[a]),this},u.prototype.ch=function(a){if("undefined"==typeof a)return this;if(a!=parseInt(a)||0>a||a>15)throw RangeError("Bad channel value: "+a+" (must be from 0 to 15)");var b=new A(this,a);return this._push(c,[b]),b},u.prototype.mpe=function(a,b){if("undefined"==typeof a&&"undefined"==typeof b)return this;ka.validate(a,b);var d=b?new B(this,a,b):new A(this,a);return this._push(z,[a,b]),this._push(c,[d]),d},A.prototype=new u,A.prototype.channel=function(){return this._chan},A.prototype._receive=function(a){this._port._receive(a)},A.prototype.note=function(a,b,c){return this.noteOn(a,b),c&&this.wait(c).noteOff(a),this},B.prototype=new u,B.prototype.channel=function(){return this._master},B.prototype._receive=function(a){this._port._receive(a)},B.prototype.note=function(a,b,c){return this.noteOn(a,b),c&&this.wait(c).noteOff(a),this},C.prototype=new a,C.prototype.connect=function(a){return this._push(D,[a]),this},C.prototype.disconnect=function(a){return this._push(E,[a]),this};var Ga,Ha={},Ia={_outs:[],_ins:[]},Ja=function(a){return Ga||Q(a),Ga};Ja.now=Da,Ja.info=function(){return k.prototype.info()},Ja.Widget=function(a){var b=new u;if(a instanceof Object)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b._resume(),b},k.prototype.Widget=Ja.Widget,X.prototype.reset=function(a){if(a instanceof X)return this.setType(a.getType()),this.setHour(a.getHour()),this.setMinute(a.getMinute()),this.setSecond(a.getSecond()),this.setFrame(a.getFrame()),this.setQuarter(a.getQuarter()),this;var b=a instanceof Array?a:arguments;return this.setType(b[0]),this.setHour(b[1]),this.setMinute(b[2]),this.setSecond(b[3]),this.setFrame(b[4]),this.setQuarter(b[5]),this},X.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},X.prototype.getType=function(){return this.type},X.prototype.getHour=function(){return this.hour},X.prototype.getMinute=function(){return this.minute},X.prototype.getSecond=function(){return this.second},X.prototype.getFrame=function(){return this.frame},X.prototype.getQuarter=function(){return this.quarter},X.prototype.setType=function(a){if("undefined"==typeof a||24==a)this.type=24;else if(25==a)this.type=25;else if(29.97==a)this.type=29.97,Y.apply(this);else{if(30!=a)throw RangeError("Bad SMPTE frame rate: "+a);this.type=30}return this.frame>=this.type&&(this.frame=29.97==this.type?29:this.type-1),this},X.prototype.setHour=function(a){if("undefined"==typeof a&&(a=0),a!=parseInt(a)||0>a||a>=24)throw RangeError("Bad SMPTE hours value: "+a);return this.hour=a,this},X.prototype.setMinute=function(a){if("undefined"==typeof a&&(a=0),a!=parseInt(a)||0>a||a>=60)throw RangeError("Bad SMPTE minutes value: "+a);return this.minute=a,Y.apply(this),this},X.prototype.setSecond=function(a){if("undefined"==typeof a&&(a=0),a!=parseInt(a)||0>a||a>=60)throw RangeError("Bad SMPTE seconds value: "+a);return this.second=a,Y.apply(this),this},X.prototype.setFrame=function(a){if("undefined"==typeof a&&(a=0),a!=parseInt(a)||0>a||a>=this.type)throw RangeError("Bad SMPTE frame number: "+a);return this.frame=a,Y.apply(this),this},X.prototype.setQuarter=function(a){if("undefined"==typeof a&&(a=0),a!=parseInt(a)||0>a||a>=8)throw RangeError("Bad SMPTE quarter frame: "+a);return this.quarter=a,this},X.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),Y.apply(this),this},X.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},X.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},X.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},X.prototype.read=function(a){if(a instanceof ba||(a=ba.apply(null,arguments)),240==a[0]&&127==a[1]&&1==a[3]&&1==a[4]&&247==a[9])return this.type=[24,25,29.97,30][a[5]>>5&3],this.hour=31&a[5],this.minute=a[6],this.second=a[7],this.frame=a[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==a[0]&&"undefined"!=typeof a[1]){var b=a[1]>>4,c=15&a[1];return 0==b?7==this._&&(7==this._f&&(this.reset(Z(this._a)),this.incrFrame()),this.incrFrame()):3==b?4==this._&&this.decrFrame():4==b?3==this._&&this.incrFrame():7==b&&0===this._&&(0===this._b&&(this.reset(Z(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[b]=c,this._f=this._f===b-1||0==b?b:void 0,this._b=this._b===b+1||7==b?b:void 0,this._=b,this.quarter=b,!0}return!1},X.prototype.toString=function(){return[aa(this.hour),aa(this.minute),aa(this.second),aa(this.frame)].join(":")},Ja.SMPTE=X,ba.prototype=[],ba.prototype.constructor=ba;var Ka={};ba.noteValue=function(a){return"undefined"==typeof a?void 0:Ka[a.toString().toLowerCase()]},ba.programValue=function(a){return a},ba.freq=function(a,b){return"undefined"==typeof b&&(b=440),b*Math.pow(2,(ea(ba.noteValue(a),a)-69)/12)};var La={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(wa in La)if(La.hasOwnProperty(wa))for(ya=0;12>ya&&(xa=La[wa]+12*ya,!(xa>127));ya++)Ka[wa+ya]=xa,xa>0&&(Ka[wa+"b"+ya]=xa-1,Ka[wa+"bb"+ya]=xa-2),127>xa&&(Ka[wa+"#"+ya]=xa+1,Ka[wa+"##"+ya]=xa+2);for(ya=0;128>ya;ya++)Ka[ya]=ya;var Ma={noteOff:function(a,b,c){return"undefined"==typeof c&&(c=64),[128+da(a),ea(ba.noteValue(b),b),ea(c)]},noteOn:function(a,b,c){return"undefined"==typeof c&&(c=127),[144+da(a),ea(ba.noteValue(b),b),ea(c)]},aftertouch:function(a,b,c){return[160+da(a),ea(ba.noteValue(b),b),ea(c)]},control:function(a,b,c){
return[176+da(a),ea(b),ea(c)]},program:function(a,b){return[192+da(a),ea(ba.programValue(b),b)]},pressure:function(a,b){return[208+da(a),ea(b)]},pitchBend:function(a,b){return[224+da(a),fa(b),ga(b)]},bankMSB:function(a,b){return[176+da(a),0,ea(b)]},bankLSB:function(a,b){return[176+da(a),32,ea(b)]},modMSB:function(a,b){return[176+da(a),1,ea(b)]},modLSB:function(a,b){return[176+da(a),33,ea(b)]},breathMSB:function(a,b){return[176+da(a),2,ea(b)]},breathLSB:function(a,b){return[176+da(a),34,ea(b)]},footMSB:function(a,b){return[176+da(a),4,ea(b)]},footLSB:function(a,b){return[176+da(a),36,ea(b)]},portamentoMSB:function(a,b){return[176+da(a),5,ea(b)]},portamentoLSB:function(a,b){return[176+da(a),37,ea(b)]},volumeMSB:function(a,b){return[176+da(a),7,ea(b)]},volumeLSB:function(a,b){return[176+da(a),39,ea(b)]},balanceMSB:function(a,b){return[176+da(a),8,ea(b)]},balanceLSB:function(a,b){return[176+da(a),40,ea(b)]},panMSB:function(a,b){return[176+da(a),10,ea(b)]},panLSB:function(a,b){return[176+da(a),42,ea(b)]},expressionMSB:function(a,b){return[176+da(a),11,ea(b)]},expressionLSB:function(a,b){return[176+da(a),43,ea(b)]},damper:function(a,b){return[176+da(a),64,b?127:0]},portamento:function(a,b){return[176+da(a),65,b?127:0]},sostenuto:function(a,b){return[176+da(a),66,b?127:0]},soft:function(a,b){return[176+da(a),67,b?127:0]},allSoundOff:function(a){return[176+da(a),120,0]},allNotesOff:function(a){return[176+da(a),123,0]}},Na={mtc:function(a){return[241,$(a)]},songPosition:function(a){return[242,fa(a),ga(a)]},songSelect:function(a){return[243,ea(a)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},"continue":function(){return[251]},stop:function(){return[252]},active:function(){return[254]},sxIdRequest:function(){return[240,126,127,6,1,247]},sxFullFrame:function(a){return[240,127,127,1,1,_(a),a.getMinute(),a.getSecond(),a.getFrame(),247]},reset:function(){return[255]}};for(wa in Na)Na.hasOwnProperty(wa)&&ia(wa,Na[wa]);for(wa in Ma)Ma.hasOwnProperty(wa)&&ia(wa,Ma[wa]);B.prototype.noteOn=function(a,b){var c=ba.noteOn(this._master,a,b);return c._mpe=c[1],this.send(c),this},B.prototype.noteOff=function(a,b){var c=ba.noteOff(this._master,a,b);return c._mpe=c[1],this.send(c),this},B.prototype.aftertouch=function(a,b){return this.send(ba.aftertouch(this._master,a,b)),this};var Oa={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(wa=0;16>wa;wa++)Oa[wa]=wa;ba.prototype.getChannel=function(){var a=this[0];if(!("undefined"==typeof a||128>a||a>239))return 15&a},ba.prototype.setChannel=function(a){var b=this[0];return"undefined"==typeof b||128>b||b>239?this:(a=Oa[a],"undefined"!=typeof a&&(this[0]=240&b|a),this)},ba.prototype.getNote=function(){var a=this[0];if(!("undefined"==typeof a||128>a||a>175))return this[1]},ba.prototype.setNote=function(a){var b=this[0];return"undefined"==typeof b||128>b||b>175?this:(a=ba.noteValue(a),"undefined"!=typeof a&&(this[1]=a),this)},ba.prototype.getVelocity=function(){var a=this[0];if(!("undefined"==typeof a||144>a||a>159))return this[2]},ba.prototype.setVelocity=function(a){var b=this[0];return"undefined"==typeof b||144>b||b>159?this:(a=parseInt(a),a>=0&&128>a&&(this[2]=a),this)},ba.prototype.getSysExChannel=function(){return 240==this[0]?this[2]:void 0},ba.prototype.setSysExChannel=function(a){return 240==this[0]&&this.length>2&&(a=parseInt(a),a>=0&&128>a&&(this[2]=a)),this},ba.prototype.isNoteOn=function(){var a=this[0];return"undefined"==typeof a||144>a||a>159?!1:this[2]>0},ba.prototype.isNoteOff=function(){var a=this[0];return"undefined"==typeof a||128>a||a>159?!1:144>a?!0:0==this[2]},ba.prototype.isSysEx=function(){return 240==this[0]},ba.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},ba.prototype.toString=function(){if(!this.length)return"empty";var a=ja(this);if(this[0]<128)return a;var b={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]];if(b)return a+" -- "+b;var c=this[0]>>4;return(b={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[c])?a+" -- "+b:9==c?a+" -- "+(this[2]?"Note On":"Note Off"):11!=c?a:(b={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal On/Off",65:"Portamento On/Off",66:"Sostenuto On/Off",67:"Soft Pedal On/Off",68:"Legato Footswitch",69:"Hold 2",70:"Sound Controller 1",71:"Sound Controller 2",72:"Sound Controller 3",73:"Sound Controller 4",74:"Sound Controller 5",75:"Sound Controller 6",76:"Sound Controller 7",77:"Sound Controller 8",78:"Sound Controller 9",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]],b||(b="Undefined"),a+" -- "+b)},ba.prototype._stamp=function(a){return this._from.push(a._orig?a._orig:a),this},ba.prototype._unstamp=function(a){if("undefined"==typeof a)this._from=[];else{a._orig&&(a=a._orig);var b=this._from.indexOf(a);b>-1&&this._from.splice(b,1)}return this},ba.prototype._stamped=function(a){a._orig&&(a=a._orig);for(var b=0;b<this._from.length;b++)if(this._from[b]==a)return!0;return!1},Ja.MIDI=ba,ka.validate=function(a){var b=a instanceof Array?a:arguments;if(b[0]!=parseInt(b[0])||b[0]<0||b[0]>14)throw RangeError("Bad master channel value: "+b[0]);if(b[1]!=parseInt(b[1])||b[1]<0||b[0]+b[1]>15)throw RangeError("Bad zone size value: "+b[1])},ka.prototype.reset=function(){for(var a=0;16>a;a++)this[a]={band:0,master:a}},ka.prototype.setup=function(a,b){ka.validate(a,b);var c,d=a+b;if((this[a].master!=a||this[a].band!=b)&&(b||this[a].band)){for(this[a].band?(c=a+this[a].band,c>d&&(d=c)):this[a].master==a-1?(c=a-1,c+=this[c].band,c>d&&(d=c),this[a-1]={band:0,master:a-1}):this[a].master!=a&&(c=this[a].master,c+=this[c].band,c>d&&(d=c),this[this[a].master].band=a-this[a].master-1),this[a].master=a,this[a].band=b,c=a+1;a+b>=c;c++)this[c].band&&d<c+this[c].band&&(d=c+this[c].band),this[c]={band:0,master:a};for(;d>=c;c++)this[c]={band:0,master:c}}},ka.prototype.filter=function(a){var b=a.getChannel();if(!this[b]||!this[this[b].master].band)return a;var c,d,e,f=this[b].master,g=this[f].band;if("undefined"!=typeof a._mpe){for(e=256,c=f+1;f+g>=c;c++)if(this[c].notes){for(e>this[c].notes.length&&(b=c,e=this[c].notes.length),d=0;d<this[c].notes.length;d++)if(this[c].notes[d]==a._mpe){b=c,e=-1;break}}else e>0&&(b=c,e=0);a.setChannel(b),a._mpe=void 0}return b==f?a:(a.isNoteOn()?(this[b].notes||(this[b].notes=[]),i(this[b].notes,a.getNote())):a.isNoteOff()&&this[b].notes&&j(this[b].notes,a.getNote()),a)},Ja.MPE=ka,Ja.lib={},Ja.lib.openMidiOut=function(a,b){var c=new u;return b._openOut(c,a),c},Ja.lib.openMidiIn=function(a,b){var c=new u;return b._openIn(c,a),c},Ja.lib.registerMidiOut=function(a,b){for(var c=b._info(a),d=0;d<Ia._outs.length;d++)if(Ia._outs[d].name==c.name)return!1;return c.engine=b,Ia._outs.push(c),Ga&&Ga._bad&&(Ga._repair(),Ga._resume()),!0},Ja.lib.registerMidiIn=function(a,b){for(var c=b._info(a),d=0;d<Ia._ins.length;d++)if(Ia._ins[d].name==c.name)return!1;return c.engine=b,Ia._ins.push(c),Ga&&Ga._bad&&(Ga._repair(),Ga._resume()),!0};var Pa;Ja.lib.getAudioContext=function(){return la(),Pa};var Qa,Ra,Sa=[],Ta={},Ua={},Va={},Wa={},Xa=za.Promise;"function"!=typeof Xa&&(Xa=function(a){this.executor=a},Xa.prototype.then=function(a,b){"function"!=typeof a&&(a=function(){}),"function"!=typeof b&&(b=function(){}),this.executor(a,b)});var Ya=za.Map;return"function"!=typeof Ya&&(Ya=function(){this.store={},this.keys=[]},Ya.prototype.set=function(a,b){return this.keys.push(a),this.store[a]=b,this.size=this.keys.length,this},Ya.prototype.forEach=function(a){var b,c,d=this.keys.length;for(b=0;d>b;b++)c=this.store[this.keys[b]],a(c)}),pa.prototype.onstatechange=function(){},sa.prototype.open=function(){var a=this;return new Xa(function(b,c){var d=Va[a.name];d?b(a):Ja().openMidiOut(a.name).or(c).and(function(){Va[a.name]=this,a.state="connected",a.connection="open",b(a)})})},sa.prototype.close=function(){var a=Va[this.name];return a&&(a.close(),this.state="disconnected",this.connection="closed",Va[this.name]=void 0),this},sa.prototype.clear=function(){},sa.prototype.send=function(a,b){var c=Va[this.name];if(c){for(var d=[],e=0;e<a.length;e++){if(!(a[e]==Math.floor(a[e])&&a[e]>=0&&a[e]<=255))return;d.push(a[e])}b>Da()?setTimeout(function(){c.send(d)},b-Da()):c.send(d)}else{var f=this;f.open().then(function(){f.send(a,b)},ma)}},ta.prototype.onmidimessage=function(){},ta.prototype.open=function(){var a=this;return new Xa(function(b,c){var d=Wa[a.name];d?b(a):Ja().openMidiIn(a.name).or(c).and(function(){Wa[a.name]=this,a.state="connected",a.connection="open",this.connect(function(b){a.onmidimessage(new ra(a,new Uint8Array(b)))}),b(a)})})},ta.prototype.close=function(){var a=Wa[this.name];return a&&(a.close(),this.state="disconnected",this.connection="closed",Va[this.name]=void 0),this.onmidimessage=ta.prototype.onmidimessage,this},Ja.requestMIDIAccess=function(){function a(){Qa=c;for(var a=0;a<Sa.length;a++)Sa[a](Qa)}function b(){d--,d||a()}var c,d;return new Xa(function(e,f){Qa?e(Qa):(Sa.push(e),1==Sa.length&&(c=new pa,Ja().or(a).and(function(){var a=this.info();d=a.inputs.length+a.outputs.length;var e,f;for(e=0;e<a.outputs.length;e++)f=new sa(a.outputs[e]),c.outputs.set(f.id,f),f.open().then(b,b);for(e=0;e<a.inputs.length;e++)f=new ta(a.inputs[e]),c.inputs.set(f.id,f),f.open().then(b,b)})))})},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=Ja.requestMIDIAccess),Ja.close=function(){Ha._close&&Ha._close()},Ja});