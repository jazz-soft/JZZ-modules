!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b:"function"==typeof define&&define.amd?define("JZZ.synth.OSC",["JZZ"],b):b(JZZ)}(this,function(a){function b(){this.channels=[],this.channel=function(a){return this.channels[a]||(this.channels[a]=new c),this.channels[a]},this.play=function(a){var b=a[0],c=a[1],d=a[2];if(!(0>b||b>255)){var e=15&b,f=b>>4;9==f?this.channel(e).play(c,d):8==f?this.channel(e).play(c,0):11==f&&(120==c||123==c?this.channel(e).allSoundOff():64==c&&this.channel(e).damper(!!d))}}}function c(){this.notes=[],this.sustain=!1,this.note=function(a){return this.notes[a]||(this.notes[a]=new d(a,this)),this.notes[a]},this.play=function(a,b){this.note(a).play(b)},this.allSoundOff=function(){for(var a=0;a<this.notes.length;a++)this.notes[a]&&this.notes[a].stop()},this.damper=function(a){if(!a&&this.sustain!=a)for(var b=0;b<this.notes.length;b++)this.notes[b]&&this.notes[b].sustain&&this.notes[b].stop();this.sustain=a}}function d(a,b){this.note=a,this.channel=b,this.freq=440*Math.pow(2,(a-69)/12),this.stop=function(){try{this.oscillator&&this.oscillator.stop(0),this.oscillator=void 0,this.sustain=!1}catch(a){}},this.play=function(a){if(!a&&this.channel.sustain||this.stop(),!a)return void(this.sustain=this.channel.sustain);var b=a/127;this.oscillator=f.createOscillator(),this.oscillator.type="sawtooth",this.oscillator.frequency.setTargetAtTime(this.freq,f.currentTime,.01),this.oscillator.start||(this.oscillator.start=this.oscillator.noteOn),this.oscillator.stop||(this.oscillator.stop=this.oscillator.noteOff),this.gain=f.createGain();var c=2,d=f.currentTime;this.gain.gain.setValueAtTime(b,d),this.gain.gain.exponentialRampToValueAtTime(.01*b,d+c),this.oscillator.connect(this.gain),this.gain.connect(f.destination),this.oscillator.start(0)}}if(a){a.synth||(a.synth={});var e="1.0.1",f=a.lib.getAudioContext(),g={},h={};h._info=function(a){return a||(a="JZZ.synth.OSC"),{type:"Web Audo",name:a,manufacturer:"virtual",version:e}},h._openOut=function(a,c){return f?(g[c]||(g[c]=new b),a._info=h._info(c),a._receive=function(a){g[c].play(a)},void a._resume()):void a._crash("AudioContext not supported")},a.synth.OSC=function(b){return a.lib.openMidiOut(b,h)},a.synth.OSC.register=function(b){return f?a.lib.registerMidiOut(b,h):!1}}});